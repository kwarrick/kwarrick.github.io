<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>IP masquerading &middot; warrick.io</title>

    <link rel="stylesheet" href="//warrick.io/css/jane.css">
    <link rel="stylesheet" href="//warrick.io/css/syntax.css">
    <link rel="stylesheet" href="//warrick.io/css/font-awesome.css">


    <link href="" rel="alternate" type="application/rss+xml" title="warrick.io" />
  </head>
  <body>
    
  <h1>IP masquerading</h1>
  <span class="post-date">Wed, Jan 11, 2012</span>
    <p>Not long ago, I found myself in need of a subnet of virtual machines. Using
VirtualBox I configured a number of VMs with <code>Internal Network</code>
interfaces and a gateway VM with two interfaces &mdash; one <code>Internal Network</code>
interface and one <code>NAT</code> interface.</p>

<p>It isn&rsquo;t the first time I needed to configure a Linux box as a gateway, but I
always forget how to configure IP masquerading. So, needless to say I&rsquo;m taking
note of it here:</p>

<p><b>1. Configure the external interface:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ ifconfig eth0 <span class="m">10</span>.0.0.2 netmask <span class="m">255</span>.255.255.0 
  $ <span class="nb">echo</span> <span class="s2">&#34;nameserver 8.8.8.8&#34;</span> &gt; /etc/resolv.conf
 
  <span class="c1"># or for dhcp
</span><span class="c1"></span>  $ dhclient eth0</code></pre></div>
<p><b>2. Configure the internal interface:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ ifconfig eth1 <span class="m">192</span>.168.0.1 netmask <span class="m">255</span>.255.255.0</code></pre></div>
<p><b>3. Configure iptables:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></pre></div>
<p><b>4. Enable ip_forwarding:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ <span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward</code></pre></div>
<p><b> or configure it in <code>/etc/sysctl.conf</code>,
   which will persist after reboot.</b></p>

<p>Obviously, depending on your distro, your interface configuration, etcetera,
etcetera, you will have to adjust.</p>

  </div>

  </body>
</html>
